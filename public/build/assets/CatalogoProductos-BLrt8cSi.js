import{j as e}from"./RequirementCard-DEdD30eg.js";import{r as n}from"./index-RYns6xqu.js";import{C as ee,B as te,H as se,aS as re,aT as V,aU as oe,F as ne}from"./CreateReactScript-C-mUikVe.js";import{c as ae}from"./ReactAppend-vpV7VTGG.js";import{C as ie}from"./Detail-BKcVR7Sx.js";import"./Filter-BDLE8FWR.js";import"./axios-B4uVmeYG.js";import"./index-CXU7o9CY.js";import"./TippyButton-Duhaw_sS.js";import"./DataGrid-Cd7cnf9r.js";import"./___vite-browser-external_commonjs-proxy-DbMF7jdq.js";import"./MenuItem-CBKDeUjr.js";import"./Results-CoLI09XT.js";import"./sweetalert2.all-DJo0UVK6.js";import"./DxBox-DZgBbgD6.js";import"./TinyMCEFormGroup-TcwoFScW.js";import"./index-DNUR7M9R.js";import"./index-SDlHnhXR.js";import"./HomeSeccionBlog-CZ04iwe8.js";import"./CarruselBrands-Chpi1Apc.js";import"./Strengths-8rnVxSkq.js";import"./ModalAppointment-BjEduSb5.js";import"./CallToAction-3RvJBMpr.js";import"./WeCupSection-CkKcxXUy.js";import"./BlurText-Cr9yZ_QA.js";import"./Supplies-DJwkpyzw.js";import"./Banner-CXqQ-nCn.js";import"./HeroSecctionEmpresa-Bs7Po8J9.js";import"./WhatsAppModal-BCTi89gL.js";function le({propiedades:c,searchFilters:d={},faqs:W=[],landing:O}){const[C,G]=n.useState(d.location||"");n.useState("Fecha");const[m,R]=n.useState(""),[p,q]=n.useState([0,500]),[o,H]=n.useState("relevancia"),[$,w]=n.useState(!1),[_,j]=n.useState(!1),[I,v]=n.useState(!1),[Q,B]=n.useState(!1),[h,N]=n.useState({priceRange:[0,500],guests:"",bedrooms:"",amenities:[],services:[],characteristics:[],propertyType:"",location:null,instantBook:!1,featured:!1}),[u,U]=n.useState(!1),[y,k]=n.useState(!0),[D,M]=n.useState(c||[]),[J,L]=n.useState({total:(c==null?void 0:c.length)||0}),[E,K]=n.useState(null),[A,T]=n.useState(null),X=async()=>{try{const s=await(await fetch("/api/properties/location-stats")).json();s.success&&s.center&&(K(s),T(s.center),console.log("🗺️ Mapa centrado en:",s.center.location,"con",s.center.count,"propiedades"))}catch(t){console.error("Error loading location stats:",t),T({lat:-12.046374,lng:-77.042793,location:"Lima, Perú",count:0})}};n.useEffect(()=>{if(X(),d){const t=(parseInt(d.adults)||0)+(parseInt(d.children)||0);t>0&&(R(t.toString()),N(s=>({...s,guests:t.toString()}))),(d.location||t>0)&&console.log("Filtros de búsqueda aplicados:",d)}},[d]),n.useEffect(()=>{c&&(M(c),L({total:c.length}))},[c]);const g=(t=h)=>{let s=c||[];C&&(s=s.filter(r=>[r.district||"",r.province||"",r.department||"",r.address||""].join(" ").toLowerCase().includes(C.toLowerCase())));const l=t.priceRange||p;(l[0]>0||l[1]<500)&&(s=s.filter(r=>{const x=parseFloat(r.price_per_night||0);return x>=l[0]&&x<=l[1]}));const a=t.guests||m;a&&(s=s.filter(r=>parseInt(r.max_guests||0)>=parseInt(a))),t.bedrooms&&(s=s.filter(r=>parseInt(r.bedrooms||0)>=parseInt(t.bedrooms)));const i=[...t.amenities||[],...t.services||[],...t.characteristics||[]];i.length>0&&(s=s.filter(r=>{const x=r.amenities||[];return i.some(S=>x.some(z=>z.toLowerCase().includes(S.toLowerCase())))})),t.propertyType&&t.propertyType!=="cualquier"&&(s=s.filter(r=>r.property_type&&r.property_type.toLowerCase().includes(t.propertyType.toLowerCase()))),t.instantBook&&(s=s.filter(r=>r.instant_book===!0)),t.featured&&(s=s.filter(r=>r.featured===!0)),t.location&&(s=s.filter(r=>!r.latitude||!r.longitude?!1:Z(t.location.lat,t.location.lng,parseFloat(r.latitude),parseFloat(r.longitude))<=5)),s=Y(s,o),M(s),L({total:s.length})},Y=(t,s)=>{const l=[...t];switch(s){case"precio-menor":return l.sort((a,i)=>parseFloat(a.price_per_night||0)-parseFloat(i.price_per_night||0));case"precio-mayor":return l.sort((a,i)=>parseFloat(i.price_per_night||0)-parseFloat(a.price_per_night||0));case"fecha-reciente":return l.sort((a,i)=>new Date(i.created_at||0)-new Date(a.created_at||0));case"fecha-antigua":return l.sort((a,i)=>new Date(a.created_at||0)-new Date(i.created_at||0));case"rating":return l.sort((a,i)=>parseFloat(i.rating||0)-parseFloat(a.rating||0));case"huespedes":return l.sort((a,i)=>parseInt(i.max_guests||0)-parseInt(a.max_guests||0));default:return l.sort((a,i)=>a.featured&&!i.featured?-1:!a.featured&&i.featured?1:parseFloat(i.rating||0)-parseFloat(a.rating||0))}},Z=(t,s,l,a)=>{const r=(l-t)*Math.PI/180,x=(a-s)*Math.PI/180,S=Math.sin(r/2)*Math.sin(r/2)+Math.cos(t*Math.PI/180)*Math.cos(l*Math.PI/180)*Math.sin(x/2)*Math.sin(x/2);return 6371*(2*Math.atan2(Math.sqrt(S),Math.sqrt(1-S)))},F=t=>{G(t.target.value),setTimeout(()=>g(),300)},P=t=>{R(t),j(!1);const s={...h,guests:t};N(s),g(s)},f=(t,s)=>{q([t,s]),v(!1);const l={...h,priceRange:[t,s]};N(l),g(l)},b=t=>{H(t),w(!1),g()};return n.useEffect(()=>{c&&g()},[o]),n.useEffect(()=>{c&&(M(c),L({total:c.length}),d&&(d.location||d.adults||d.children)&&setTimeout(()=>{g()},100))},[c,d]),n.useEffect(()=>{const t=s=>{s.target.closest(".dropdown-container")||(w(!1),j(!1),v(!1))};return document.addEventListener("mousedown",t),()=>document.removeEventListener("mousedown",t)},[]),n.useEffect(()=>{const t=()=>{U(window.innerWidth<768),window.innerWidth>=768&&k(!0)};return t(),window.addEventListener("resize",t),()=>{window.removeEventListener("resize",t)}},[]),e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx(se,{}),e.jsx("div",{className:"bg-white sticky top-0 z-40 shadow-sm",children:e.jsxs("div",{className:"mx-auto px-[5%] py-3 md:py-4",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2 md:gap-4",children:[e.jsx("div",{className:"flex-1 max-w-md",children:e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx("svg",{className:"h-4 w-4 md:h-5 md:w-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})}),e.jsx("input",{type:"text",value:C,onChange:F,className:"block w-full pl-9 pr-3 py-2 md:py-3 border border-gray-300 rounded-full text-sm md:text-base leading-5 bg-white placeholder-gray-500 focus:outline-none focus:placeholder-gray-400 focus:ring-1 focus:ring-blue-500 focus:border-blue-500",placeholder:"¿A dónde vas?"})]})}),e.jsxs("div",{className:"flex items-center gap-1 md:gap-3",children:[e.jsxs("div",{className:"relative dropdown-container",children:[e.jsxs("button",{onClick:()=>{w(!$),j(!1),v(!1)},className:"px-2 md:px-4 py-2 border border-gray-300 rounded-full text-xs md:text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500 flex items-center gap-1 md:gap-2",children:[e.jsx("span",{className:"hidden md:inline",children:o==="relevancia"?"Relevancia":o==="precio-menor"?"Precio: menor a mayor":o==="precio-mayor"?"Precio: mayor a menor":o==="fecha-reciente"?"Más recientes":o==="fecha-antigua"?"Más antiguos":o==="rating"?"Mejor valorados":o==="huespedes"?"Más huéspedes":"Ordenar"}),e.jsx("span",{className:"md:hidden",children:o==="relevancia"?"Relevancia":o==="precio-menor"?"Precio ↓":o==="precio-mayor"?"Precio ↑":o==="fecha-reciente"?"Recientes":o==="fecha-antigua"?"Antiguos":o==="rating"?"Rating":o==="huespedes"?"Huéspedes":"Orden"}),e.jsx("svg",{className:"w-3 h-3 md:w-4 md:h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),$&&e.jsx("div",{className:"absolute top-full mt-2 w-48 md:w-56 right-0 md:right-auto bg-white border border-gray-200 rounded-lg shadow-lg z-50",children:e.jsxs("div",{className:"p-2",children:[e.jsx("button",{onClick:()=>b("relevancia"),className:`w-full text-left px-3 py-2 rounded-md text-sm hover:bg-gray-100 ${o==="relevancia"?"bg-blue-50 text-blue-700":""}`,children:"Relevancia"}),e.jsx("button",{onClick:()=>b("precio-menor"),className:`w-full text-left px-3 py-2 rounded-md text-sm hover:bg-gray-100 ${o==="precio-menor"?"bg-blue-50 text-blue-700":""}`,children:"Precio: menor a mayor"}),e.jsx("button",{onClick:()=>b("precio-mayor"),className:`w-full text-left px-3 py-2 rounded-md text-sm hover:bg-gray-100 ${o==="precio-mayor"?"bg-blue-50 text-blue-700":""}`,children:"Precio: mayor a menor"}),e.jsx("button",{onClick:()=>b("fecha-reciente"),className:`w-full text-left px-3 py-2 rounded-md text-sm hover:bg-gray-100 ${o==="fecha-reciente"?"bg-blue-50 text-blue-700":""}`,children:"Más recientes"}),e.jsx("button",{onClick:()=>b("fecha-antigua"),className:`w-full text-left px-3 py-2 rounded-md text-sm hover:bg-gray-100 ${o==="fecha-antigua"?"bg-blue-50 text-blue-700":""}`,children:"Más antiguos"}),e.jsx("button",{onClick:()=>b("rating"),className:`w-full text-left px-3 py-2 rounded-md text-sm hover:bg-gray-100 ${o==="rating"?"bg-blue-50 text-blue-700":""}`,children:"Mejor valorados"}),e.jsx("button",{onClick:()=>b("huespedes"),className:`w-full text-left px-3 py-2 rounded-md text-sm hover:bg-gray-100 ${o==="huespedes"?"bg-blue-50 text-blue-700":""}`,children:"Más huéspedes"})]})})]}),e.jsxs("div",{className:"relative dropdown-container hidden xs:block",children:[e.jsxs("button",{onClick:()=>{j(!_),w(!1),v(!1)},className:`px-2 md:px-4 py-2 border rounded-full text-xs md:text-sm font-medium ${m?"bg-blue-50 border-blue-500 text-blue-700":"bg-white border-gray-300 text-gray-700"} hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500 flex items-center gap-1 md:gap-2`,children:[e.jsx("span",{className:"hidden md:inline",children:m?`${m} huéspedes`:"Huéspedes"}),e.jsx("span",{className:"md:hidden",children:m?`${m}`:"Huéspedes"}),e.jsx("svg",{className:"w-3 h-3 md:w-4 md:h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),_&&e.jsx("div",{className:"absolute top-full mt-2 w-40 md:w-48 right-0 md:right-auto bg-white border border-gray-200 rounded-lg shadow-lg z-50",children:e.jsxs("div",{className:"p-2",children:[[1,2,3,4,5,6,7,8].map(t=>e.jsxs("button",{onClick:()=>P(t.toString()),className:`w-full text-left px-3 py-2 rounded-md text-sm hover:bg-gray-100 ${m===t.toString()?"bg-blue-50 text-blue-700":""}`,children:[t," huésped",t>1?"es":""]},t)),e.jsx("button",{onClick:()=>P("8+"),className:`w-full text-left px-3 py-2 rounded-md text-sm hover:bg-gray-100 ${m==="8+"?"bg-blue-50 text-blue-700":""}`,children:"8+ huéspedes"}),m&&e.jsx("div",{className:"border-t pt-2 mt-2",children:e.jsx("button",{onClick:()=>P(""),className:"w-full text-left px-3 py-2 rounded-md text-sm text-red-600 hover:bg-red-50",children:"Limpiar"})})]})})]}),e.jsxs("div",{className:"relative dropdown-container hidden sm:block",children:[e.jsxs("button",{onClick:()=>{v(!I),w(!1),j(!1)},className:`px-2 md:px-4 py-2 border rounded-full text-xs md:text-sm font-medium ${p[0]>0||p[1]<500?"bg-blue-50 border-blue-500 text-blue-700":"bg-white border-gray-300 text-gray-700"} hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500 flex items-center gap-1 md:gap-2`,children:[p[0]>0||p[1]<500?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"hidden md:inline",children:`S/ ${p[0]} - S/ ${p[1]}`}),e.jsx("span",{className:"md:hidden",children:`S/${p[0]}-${p[1]}`})]}):e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"hidden md:inline",children:"Rango de precio"}),e.jsx("span",{className:"md:hidden",children:"Precio"})]}),e.jsx("svg",{className:"w-3 h-3 md:w-4 md:h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),I&&e.jsx("div",{className:"absolute top-full mt-2 w-48 md:w-64 right-0 md:right-auto bg-white border border-gray-200 rounded-lg shadow-lg z-50",children:e.jsxs("div",{className:"p-4",children:[e.jsx("h4",{className:"font-medium mb-3",children:"Rango de precio por noche"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("button",{onClick:()=>f(0,50),className:"w-full text-left px-3 py-2 rounded-md text-sm hover:bg-gray-100",children:"S/ 0 - S/ 50"}),e.jsx("button",{onClick:()=>f(50,100),className:"w-full text-left px-3 py-2 rounded-md text-sm hover:bg-gray-100",children:"S/ 50 - S/ 100"}),e.jsx("button",{onClick:()=>f(100,200),className:"w-full text-left px-3 py-2 rounded-md text-sm hover:bg-gray-100",children:"S/ 100 - S/ 200"}),e.jsx("button",{onClick:()=>f(200,300),className:"w-full text-left px-3 py-2 rounded-md text-sm hover:bg-gray-100",children:"S/ 200 - S/ 300"}),e.jsx("button",{onClick:()=>f(300,500),className:"w-full text-left px-3 py-2 rounded-md text-sm hover:bg-gray-100",children:"S/ 300 - S/ 500"}),e.jsx("button",{onClick:()=>f(500,1e3),className:"w-full text-left px-3 py-2 rounded-md text-sm hover:bg-gray-100",children:"S/ 500+"}),e.jsx("div",{className:"border-t pt-2 mt-2",children:e.jsx("button",{onClick:()=>f(0,500),className:"w-full text-left px-3 py-2 rounded-md text-sm text-red-600 hover:bg-red-50",children:"Limpiar rango"})})]})]})})]}),e.jsx("button",{onClick:()=>{B(!0)},className:"p-2 border border-gray-300 rounded-full text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500",children:e.jsx("svg",{className:"h-4 w-4 md:h-5 md:w-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.207A1 1 0 013 6.5V4z"})})}),u&&e.jsx("button",{onClick:()=>k(!y),className:"p-2 border border-gray-300 rounded-full text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500",children:y?e.jsx("svg",{className:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 6h16M4 12h16m-7 6h7"})}):e.jsx("svg",{className:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 011.447-.894L9 7m0 13l6-3m-6 3V7m6 10l4.553 2.276A1 1 0 0021 18.382V7.618a1 1 0 00-.553-.894L15 4m0 13V4m0 0L9 7"})})})]})]}),e.jsx("div",{className:"mt-2",children:e.jsxs("p",{className:"text-sm md:text-lg text-gray-600",children:[J.total," propiedades encontradas"]})})]})}),e.jsx(re,{isOpen:Q,onClose:()=>B(!1),onApplyFilters:t=>{console.log("Modal filters received:",t);const s={...h,instantBook:t.recommended==="reservacion",featured:t.highlighted==="favoritos",propertyType:t.accommodationType==="cualquier"?"":t.accommodationType,services:t.services||[],amenities:t.amenities||[],characteristics:t.features||[],priceRange:h.priceRange,guests:h.guests,bedrooms:h.bedrooms,location:h.location};console.log("Applied filters:",s),N(s),g(s)},currentFilters:h}),e.jsxs("div",{className:"flex flex-col md:flex-row bg-white gap-0 md:gap-6 min-h-screen md:px-[5%]",children:[u&&e.jsxs("div",{className:"sticky top-[70px] z-30 flex bg-white border-b shadow-sm",children:[e.jsx("button",{onClick:()=>k(!1),className:`flex-1 py-3 font-medium text-sm ${y?"text-gray-500":"text-blue-600 border-b-2 border-blue-600"}`,children:"Lista"}),e.jsx("button",{onClick:()=>k(!0),className:`flex-1 py-3 font-medium text-sm ${y?"text-blue-600 border-b-2 border-blue-600":"text-gray-500"}`,children:"Mapa"})]}),(!u||u&&!y)&&e.jsx("div",{className:`${u?"w-full":"w-2/3"} flex flex-col bg-white property-list-container`,children:e.jsx(V,{propiedades:D,center:A,locationStats:E,isMobileView:u,showMapOnly:!1})}),(!u||u&&y)&&e.jsx("div",{className:`${u?"w-full h-[calc(100vh-145px)]":"w-1/3 sticky top-0 h-screen"} rounded-xl overflow-hidden`,children:e.jsx(V,{propiedades:D,center:A,locationStats:E,isMobileView:u,showMapOnly:!0})})]}),e.jsx(oe,{faqs:W,landingFAQS:O}),e.jsx(ne,{})]})}ee((c,d)=>{ae(c).render(e.jsx(ie,{children:e.jsx(te,{...d,children:e.jsx(le,{...d})})}))});
