var S=Object.defineProperty;var I=(f,e,i)=>e in f?S(f,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):f[e]=i;var h=(f,e,i)=>(I(f,typeof e!="symbol"?e+"":e,i),i);import{j as O}from"./RequirementCard-DEdD30eg.js";import{r as q}from"./index-RYns6xqu.js";import{m as x}from"./main-Y8JAyXgE.js";import{B as V}from"./Results-BBVbNL2k.js";import"./___vite-browser-external_commonjs-proxy-DbMF7jdq.js";class k extends V{constructor(){super(...arguments);h(this,"path","items");h(this,"verifyStock",async i=>{try{const{status:l,result:y}=await x.Fetch(`/api/${this.path}/verify-stock`,{method:"POST",body:JSON.stringify(i)});if(!l)throw new Error((y==null?void 0:y.message)??"Ocurrió un error al consultar el stock de los productos");return y.data??[]}catch{return[]}});h(this,"getDestacados",async()=>{try{const{status:i,result:l}=await x.Fetch(`/api/${this.path}/get-destacados`,{method:"GET"});if(!i)throw new Error((l==null?void 0:l.message)??"Ocurrió un error al consultar el stock de los productos");return l.data??[]}catch{return[]}})}}const v=q.createContext(),P=new k,F=({children:f})=>{const[e,i]=q.useState(()=>{const a=localStorage.getItem("carrito");return a?JSON.parse(a):[]}),l=async()=>{try{if(e.length===0)return;P.verifyStock(e.map(a=>a.id)).then(a=>{const r=e.map(c=>{const t=a.find(n=>n.id===c.id);return t?{...c,price:t.price,final_price:t.final_price,discount:t.discount,name:t.name}:c});i(r)})}catch(a){console.error("Error al actualizar precios:",a)}};q.useEffect(()=>{l()},[]),q.useEffect(()=>{localStorage.setItem("carrito",JSON.stringify(e))},[e]);const y=a=>{i(r=>{var s;if(!(a.sizes&&a.sizes.length>0||a.colors&&a.colors.length>0))return r.find(o=>o.id===a.id)?r.map(o=>o.id===a.id?{...o,quantity:o.quantity+a.quantity}:o):[...r,{...a,variations:[],quantity:a.quantity}];const t={color:a.selectedColor||null,size:a.selectedSize||null,quantity:a.quantity},n=r.findIndex(u=>u.id===a.id);if(n>=0){const u=[...r],o=u[n],g=((s=o.variations)==null?void 0:s.findIndex(d=>d.color===t.color&&d.size===t.size))??-1;return g>=0?u[n]={...o,variations:o.variations.map((d,E)=>E===g?{...d,quantity:d.quantity+t.quantity}:d)}:u[n]={...o,variations:[...o.variations,t]},u}else return[...r,{...a,variations:[t],quantity:a.quantity}]})},z=a=>{i(r=>r.filter(c=>c.id!==a))},C=()=>{i([])},w=(a,r=null)=>{i(c=>c.map(t=>t.id===a&&(!t.variations||t.variations.length===0)?{...t,quantity:t.quantity+1}:t.id===a&&t.variations&&t.variations.length>0?r?{...t,variations:t.variations.map(n=>n.color===r.color&&n.size===r.size?{...n,quantity:n.quantity+1}:n)}:{...t,variations:t.variations.map((n,s)=>s===0?{...n,quantity:n.quantity+1}:n)}:t))},m=(a,r=null)=>{i(c=>c.map(t=>{if(t.id===a&&(!t.variations||t.variations.length===0))return{...t,quantity:Math.max(1,t.quantity-1)};if(t.id===a&&t.variations&&t.variations.length>0){if(!r){const s=t.variations.map((u,o)=>o===0?{...u,quantity:Math.max(1,u.quantity-1)}:u);return{...t,variations:s}}const n=t.variations.map(s=>s.color===r.color&&s.size===r.size?{...s,quantity:Math.max(1,s.quantity-1)}:s);return{...t,variations:n}}return t}))},p=(a,r=null)=>{i(c=>r?c.map(t=>{if(t.id===a&&t.variations){const n=t.variations.filter(s=>!(s.color===r.color&&s.size===r.size&&s.quantity===0));return n.length===0?null:{...t,variations:n}}return t}).filter(Boolean):c.filter(t=>!(t.id===a&&t.quantity===0)))};return O.jsx(v.Provider,{value:{carrito:e,agregarAlCarrito:y,eliminarProducto:z,vaciarCarrito:C,actualizarPrecios:l,decrementarCantidad:m,incrementarCantidad:w,eliminarSiCero:p},children:f})};export{F as C,v as a};
