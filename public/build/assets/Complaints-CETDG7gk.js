import{j as e}from"./RequirementCard-DEdD30eg.js";import{r as s}from"./index-RYns6xqu.js";import{c as E}from"./ReactAppend-vpV7VTGG.js";import{C as _,e as D,T,D as j,M as y,z as F,E as S}from"./CreateReactScript-C-mUikVe.js";import{S as i}from"./sweetalert2.all-DJo0UVK6.js";import"./index-CXU7o9CY.js";import"./Filter-BDLE8FWR.js";import"./axios-B4uVmeYG.js";import"./TippyButton-Duhaw_sS.js";import"./DataGrid-Cd7cnf9r.js";import"./___vite-browser-external_commonjs-proxy-DbMF7jdq.js";import"./MenuItem-CBKDeUjr.js";import"./Results-CoLI09XT.js";import"./DxBox-DZgBbgD6.js";import"./TinyMCEFormGroup-TcwoFScW.js";import"./index-DNUR7M9R.js";import"./Detail-BKcVR7Sx.js";import"./index-SDlHnhXR.js";import"./HomeSeccionBlog-CZ04iwe8.js";import"./CarruselBrands-Chpi1Apc.js";import"./Strengths-8rnVxSkq.js";import"./ModalAppointment-BjEduSb5.js";import"./CallToAction-3RvJBMpr.js";import"./WeCupSection-CkKcxXUy.js";import"./BlurText-Cr9yZ_QA.js";import"./Supplies-DJwkpyzw.js";import"./Banner-CXqQ-nCn.js";import"./HeroSecctionEmpresa-Bs7Po8J9.js";import"./WhatsAppModal-BCTi89gL.js";const l=new S,C=()=>{const n=s.useRef();s.useState(null);const c=s.useRef();s.useRef();const[o,m]=s.useState(null),[z,p]=s.useState([]);s.useState(null);const h=s.useRef(),b=async t=>{try{m(t),p([]);const r=i.fire({title:"Cargando...",allowOutsideClick:!1,didOpen:()=>{i.showLoading()}}),[a]=await Promise.all([l.getAttachments(t.id),new Promise(d=>setTimeout(d,500))]);Array.isArray(a)?p(a):(console.error("Formato de adjuntos inválido:",a),i.fire({icon:"warning",title:"Advertencia",text:"No se pudieron cargar los archivos adjuntos"})),await r.close(),$(c.current).modal("show")}catch(r){console.error("Error al abrir modal:",r),i.fire({icon:"error",title:"Error",text:"No se pudo cargar la información del reclamo"})}},w=async()=>{try{const t=$(h.current).val();if(!o||!t){i.fire({icon:"error",title:"Error",text:"Datos incompletos para actualizar el estado"});return}const r=await l.updateEstado(o.id,t);if(r.success)m(a=>({...a,estado:t})),$(n.current).dxDataGrid("instance").refresh();else throw new Error(r.message||"Error desconocido")}catch(t){console.error("Error al actualizar estado:",t),i.fire({icon:"error",title:"Error",text:t.message||"No se pudo actualizar el estado"})}},u=t=>{if(!t)return"No especificada";try{return new Date(t).toLocaleDateString("es-PE",{day:"2-digit",month:"2-digit",year:"numeric"})}catch(r){return console.error("Error formateando fecha:",r),"Fecha inválida"}},x=t=>{if(!t)return"No especificada";try{return new Date(t).toLocaleString("es-PE",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"})}catch(r){return console.error("Error formateando fecha/hora:",r),"Fecha/hora inválida"}},f=t=>({dni:"DNI",ce:"Carné Extranjería",pasaporte:"Pasaporte",ruc:"RUC"})[t]||t.toUpperCase(),g=t=>t==="queja"?"Queja":"Reclamo",N=t=>{switch(t){case"pendiente":return"badge bg-warning";case"en_proceso":return"badge bg-info";case"resuelto":return"badge bg-success";case"rechazado":return"badge bg-danger";default:return"badge bg-secondary"}},R=t=>({pendiente:"Pendiente",en_proceso:"En Proceso",resuelto:"Resuelto",rechazado:"Rechazado"})[t]||t,v=async t=>{const{isConfirmed:r}=await i.fire({title:"Eliminar reclamo",text:"¿Estás seguro de eliminar este reclamo?",icon:"warning",showCancelButton:!0,confirmButtonText:"Sí, eliminar",cancelButtonText:"Cancelar"});!r||!await l.delete(t)||$(n.current).dxDataGrid("instance").refresh()};return e.jsxs(e.Fragment,{children:[e.jsx(T,{gridRef:n,title:"Libro de Reclamaciones",rest:l,toolBar:t=>{t.unshift({widget:"dxButton",location:"after",options:{icon:"refresh",hint:"Refrescar tabla",onClick:()=>$(n.current).dxDataGrid("instance").refresh()}})},columns:[{dataField:"id",caption:"ID",visible:!1},{dataField:"numero_reclamo",caption:"N° Reclamo",width:"10%"},{dataField:"nombre_completo",caption:"Consumidor",cellTemplate:(t,{data:r})=>{t.text(`${r.nombre} ${r.apellido}`)},width:"15%"},{dataField:"tipo_documento",caption:"Doc. Identidad",cellTemplate:(t,{data:r})=>{t.text(`${f(r.tipo_documento)}: ${r.numero_documento}`)},width:"12%"},{dataField:"sede",caption:"Sede",width:"12%"},{dataField:"tipo_reclamo",caption:"Tipo",cellTemplate:(t,{data:r})=>{const a=g(r.tipo_reclamo),d=r.tipo_reclamo==="queja"?"badge bg-info":"badge bg-primary";t.append(`<span class="${d}">${a}</span>`)},width:"8%"},{dataField:"fecha_incidente",caption:"Fecha Incidente",cellTemplate:(t,{data:r})=>{t.text(u(r.fecha_incidente))},width:"10%"},{dataField:"estado",caption:"Estado",cellTemplate:(t,{data:r})=>{t.append(`<span class="${N(r.estado)}">${R(r.estado)}</span>`)},width:"10%"},{dataField:"created_at",caption:"Fecha Registro",cellTemplate:(t,{data:r})=>{t.text(x(r.created_at))},width:"10%"},{caption:"Acciones",cellTemplate:(t,{data:r})=>{t.css("text-overflow","unset"),t.append(j({className:"btn btn-xs btn-soft-primary",title:"Ver Detalles",icon:"fa fa-eye",onClick:()=>b(r)})),t.append(j({className:"btn btn-xs btn-soft-danger",title:"Eliminar",icon:"fa fa-trash",onClick:()=>v(r.id)}))},allowFiltering:!1,allowExporting:!1,width:"13%"}]}),e.jsx(y,{modalRef:c,title:`Reclamo #${(o==null?void 0:o.numero_reclamo)||""}`,footer:!0,size:"lg",onSubmit:w,children:e.jsx("div",{className:"row",id:"principal-container",children:o&&e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"col-md-12 mb-4",children:[e.jsx("h4",{className:"border-bottom pb-2",children:"Información Básica"}),e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"col-md-6",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Número de Reclamo:"})," ",o.numero_reclamo]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Fecha Registro:"})," ",x(o.created_at)]})]}),e.jsxs("div",{className:"col-md-6",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Tipo de Reclamo:"})," ",e.jsx("span",{className:o.tipo_reclamo==="queja"?"badge bg-info":"badge bg-primary",children:g(o.tipo_reclamo)})]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Fecha Incidente:"})," ",u(o.fecha_incidente)]})]}),e.jsxs(F,{col:"col-md-12",label:"Cambiar Estado",eRef:h,dropdownParent:"#principal-container",children:[e.jsx("option",{value:"pendiente",selected:(o==null?void 0:o.estado)==="pendiente",children:"Pendiente"}),e.jsx("option",{value:"en_proceso",selected:(o==null?void 0:o.estado)==="en_proceso",children:"En Proceso"}),e.jsx("option",{value:"resuelto",selected:(o==null?void 0:o.estado)==="resuelto",children:"Resuelto"}),e.jsx("option",{value:"rechazado",selected:(o==null?void 0:o.estado)==="rechazado",children:"Rechazado"})]})]})]}),e.jsxs("div",{className:"col-md-6 mb-4",children:[e.jsx("h4",{className:"border-bottom pb-2",children:"Datos del Consumidor"}),e.jsxs("div",{className:"pl-3",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Nombre:"})," ",o.nombre," ",o.apellido]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Documento:"})," ",f(o.tipo_documento)," ",o.numero_documento]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Contacto:"})," Tel:"," ",o.telefono," | Email:"," ",o.email]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Dirección:"})," ",o.direccion]})]})]}),e.jsxs("div",{className:"col-md-6 mb-4",children:[e.jsx("h4",{className:"border-bottom pb-2",children:"Detalles del Servicio"}),e.jsxs("div",{className:"pl-3",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Sede:"})," ",o.sede]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Servicio:"})," ",o.servicio]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Hora Incidente:"})," ",o.hora_incidente||"No especificada"]})]})]}),e.jsxs("div",{className:"col-md-12 mb-4",children:[e.jsx("h4",{className:"border-bottom pb-2",children:"Descripción del Reclamo"}),e.jsx("div",{className:"border p-3 bg-light rounded",children:e.jsx("p",{style:{whiteSpace:"pre-wrap"},children:o.detalle_reclamo})})]}),e.jsxs("div",{className:"col-md-12 mb-4",children:[e.jsx("h4",{className:"border-bottom pb-2",children:"Pedido del Consumidor"}),e.jsx("div",{className:"border p-3 bg-light rounded",children:e.jsx("p",{style:{whiteSpace:"pre-wrap"},children:o.pedido})})]})]})})})]})};_((n,c)=>{E(n).render(e.jsx(D,{...c,title:"Libro de Reclamaciones",children:e.jsx(C,{...c})}))});
