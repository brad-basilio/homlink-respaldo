import{j as t}from"./RequirementCard-DEdD30eg.js";import{r}from"./index-RYns6xqu.js";import{c as Y}from"./ReactAppend-vpV7VTGG.js";import{C as H,e as J,T as K,R as C,S as Q,D as O,M as X,j as Z,h as f,f as ee,o as q,q as ne}from"./CreateReactScript-C-mUikVe.js";import{S as b}from"./sweetalert2.all-DJo0UVK6.js";import{r as p}from"./DxBox-DZgBbgD6.js";import"./index-CXU7o9CY.js";import"./Filter-BDLE8FWR.js";import"./axios-B4uVmeYG.js";import"./TippyButton-Duhaw_sS.js";import"./DataGrid-Cd7cnf9r.js";import"./___vite-browser-external_commonjs-proxy-DbMF7jdq.js";import"./MenuItem-CBKDeUjr.js";import"./Results-CoLI09XT.js";import"./TinyMCEFormGroup-TcwoFScW.js";import"./index-DNUR7M9R.js";import"./Detail-BKcVR7Sx.js";import"./index-SDlHnhXR.js";import"./HomeSeccionBlog-CZ04iwe8.js";import"./CarruselBrands-Chpi1Apc.js";import"./Strengths-8rnVxSkq.js";import"./ModalAppointment-BjEduSb5.js";import"./CallToAction-3RvJBMpr.js";import"./WeCupSection-CkKcxXUy.js";import"./BlurText-Cr9yZ_QA.js";import"./Supplies-DJwkpyzw.js";import"./Banner-CXqQ-nCn.js";import"./HeroSecctionEmpresa-Bs7Po8J9.js";import"./WhatsAppModal-BCTi89gL.js";const m=new ne,te=({sections:a,positions:x,sectionPositions:o,multipleAllowedPositions:h})=>{const u=r.useRef(),g=r.useRef(),j=r.useRef(),v=r.useRef(),R=r.useRef(),d=r.useRef(),w=r.useRef(),k=r.useRef(),S=r.useRef(),l=r.useRef(),B=r.useRef(),[W,E]=r.useState(!1),[A,_]=r.useState("home"),[P,y]=r.useState(o.home||{}),L=e=>{_(e);const n=o[e]||{};y(n);const i=Object.keys(n)[0];l.current&&(l.current.value=i||"",$(l.current).trigger("change"))},D=e=>{e!=null&&e.id?E(!0):E(!1);const n=(e==null?void 0:e.section)??"home",i=(e==null?void 0:e.position)??Object.keys(o[n]||{})[0];_(n),y(o[n]||{}),j.current.value=(e==null?void 0:e.id)??"",v.current.value=(e==null?void 0:e.name)??"",R.current.value=(e==null?void 0:e.description)??"",d.image.src=`/api/banners/media/${e==null?void 0:e.image}`,d.current.value=null,w.current.value=(e==null?void 0:e.button_text)??"",k.current.value=(e==null?void 0:e.button_link)??"",S.current.value=n,l.current.value=i,B.current.value=(e==null?void 0:e.order)??0,$(g.current).modal("show")},U=async e=>{e.preventDefault();try{const n=S.current.value,i=l.current.value,s=j.current.value;let c=h.includes(i);if(i==="cambia_empresas"&&n!=="home"&&(c=!1),!c&&((await m.paginate({skip:0,take:1e3})).data||[]).find(F=>F.section===n&&F.position===i&&F.id!=s)){b.fire({icon:"warning",title:"Banner duplicado",text:`Ya existe un banner para la sección "${a[n]}" en la posición "${o[n][i]}". Solo se permite un banner por posición para esta ubicación.`,confirmButtonText:"Entendido"});return}const M={id:s||void 0,name:v.current.value,description:R.current.value,button_text:w.current.value,button_link:k.current.value,section:n,position:i,order:parseInt(B.current.value)||0},N=new FormData;for(const T in M)N.append(T,M[T]);const G=d.current.files[0];G&&N.append("image",G);const I=await m.save(N);if(console.log(I),!I)return;console.log("Refrescando tabla..."),$(u.current).dxDataGrid("instance").refresh(),console.log("Cerrando modal..."),$(g.current).modal("hide")}catch(n){console.error("Error al enviar el formulario:",n),n.message&&n.message.includes("Ya existe un banner")?b.fire({icon:"warning",title:"Banner duplicado",text:n.message,confirmButtonText:"Entendido"}):b.fire({icon:"error",title:"Error",text:"Hubo un error al enviar el formulario. Por favor, inténtalo de nuevo."})}},z=async({id:e,value:n})=>{await m.boolean({id:e,field:"visible",value:n})&&$(u.current).dxDataGrid("instance").refresh()},V=async e=>{const{isConfirmed:n}=await b.fire({title:"Eliminar banner",text:"¿Estás seguro de eliminar este banner?",icon:"warning",showCancelButton:!0,confirmButtonText:"Sí, eliminar",cancelButtonText:"Cancelar"});!n||!await m.delete(e)||$(u.current).dxDataGrid("instance").refresh()};return t.jsxs(t.Fragment,{children:[t.jsx(K,{gridRef:u,title:"Banners",rest:m,toolBar:e=>{e.unshift({widget:"dxButton",location:"after",options:{icon:"refresh",hint:"Refrescar tabla",onClick:()=>$(u.current).dxDataGrid("instance").refresh()}}),e.unshift({widget:"dxButton",location:"after",options:{icon:"plus",text:"Nuevo banner",hint:"Nuevo banner",onClick:()=>D()}})},columns:[{dataField:"id",caption:"ID",visible:!1},{dataField:"image",caption:"Imagen",width:"80px",allowFiltering:!1,cellTemplate:(e,{data:n})=>{C(e,t.jsx("img",{src:`/api/banners/media/${n.image}`,style:{width:"70px",height:"40px",objectFit:"cover",objectPosition:"center",borderRadius:"4px"}}))}},{dataField:"name",caption:"Contenido",width:"40%",cellTemplate:(e,{data:n})=>{C(e,t.jsxs("div",{children:[t.jsx("p",{className:"mb-1",children:t.jsx("b",{children:n.name})}),n.description&&t.jsx("small",{className:"text-wrap text-muted",style:{overflow:"hidden",display:"-webkit-box",WebkitBoxOrient:"vertical",WebkitLineClamp:2},children:n.description}),n.button_text&&t.jsx("div",{className:"mt-1",children:t.jsx("small",{className:"badge badge-info",children:n.button_text})})]}))}},{dataField:"section",caption:"Sección",width:"120px",cellTemplate:(e,{data:n})=>{const i=a[n.section]||n.section;e.html(p(t.jsx("span",{className:"badge text-black badge-primary",children:i})))}},{dataField:"position",caption:"Posición",width:"150px",cellTemplate:(e,{data:n})=>{const s=(o[n.section]||{})[n.position]||n.position;let c=h.includes(n.position);n.position==="cambia_empresas"&&n.section!=="home"&&(c=!1),e.html(p(t.jsxs("div",{children:[t.jsx("span",{className:"badge text-black badge-secondary",children:s}),t.jsx("br",{}),t.jsx("small",{className:`text-${c?"success":"warning"}`,children:c?"Múltiples permitidos":"Solo uno permitido"})]})))}},{dataField:"order",caption:"Orden",width:"80px",dataType:"number"},{dataField:"button_link",caption:"Enlace/Mensaje",cellTemplate:(e,{data:n})=>{n.button_link?(()=>{try{const s=new URL(n.button_link);return s.protocol==="http:"||s.protocol==="https:"}catch{return!1}})()?e.html(p(t.jsxs("div",{children:[t.jsx("span",{className:"badge badge-info",children:"Enlace externo"}),t.jsx("br",{}),t.jsx("small",{className:"text-muted text-truncate d-block",style:{maxWidth:"200px"},children:n.button_link})]}))):e.html(p(t.jsxs("div",{children:[t.jsx("span",{className:"badge badge-success",children:"Mensaje WhatsApp"}),t.jsx("br",{}),t.jsx("small",{className:"text-muted",children:n.button_link.length>30?n.button_link.substring(0,30)+"...":n.button_link})]}))):e.html(p(t.jsx("span",{className:"text-muted",children:"Sin configurar"})))}},{dataField:"visible",caption:"Visible",dataType:"boolean",width:"120px",cellTemplate:(e,{data:n})=>{C(e,t.jsx(Q,{checked:n.visible,onChange:i=>z({id:n.id,value:i.target.checked})}))}},{caption:"Acciones",cellTemplate:(e,{data:n})=>{e.css("text-overflow","unset"),e.append(O({className:"btn btn-xs btn-soft-primary",title:"Editar",icon:"fa fa-pen",onClick:()=>D(n)})),e.append(O({className:"btn btn-xs btn-soft-danger",title:"Eliminar",icon:"fa fa-trash",onClick:()=>V(n.id)}))},allowFiltering:!1,allowExporting:!1}]}),t.jsx(X,{modalRef:g,title:W?"Editar banner":"Agregar banner",onSubmit:U,size:"lg",children:t.jsxs("div",{className:"row",id:"form-banner",children:[t.jsx("input",{ref:j,type:"hidden"}),t.jsx(Z,{eRef:d,label:"Imagen del banner",col:"col-md-4",aspect:2.5,fit:"cover",required:!0}),t.jsxs("div",{className:"col-md-8",children:[t.jsx(f,{eRef:v,label:"Título del banner",required:!0}),t.jsx(ee,{eRef:R,label:"Descripción",rows:2}),t.jsxs("div",{className:"row",children:[t.jsx(f,{eRef:w,label:"Texto del botón",col:"col-md-12"}),t.jsx(f,{eRef:k,label:"Enlace personalizado o mensaje de WhatsApp",col:"col-md-12",placeholder:"https://ejemplo.com o mensaje personalizado",help:"Ingrese una URL (https://...) para enlace externo o un mensaje para WhatsApp"})]})]}),t.jsx(q,{eRef:S,label:"Sección",col:"col-md-4",required:!0,dropdownParent:"#form-banner",onChange:e=>L(e.target.value),children:Object.entries(a).map(([e,n])=>t.jsx("option",{value:e,children:n},e))}),t.jsx(q,{eRef:l,label:"Posición",col:"col-md-4",required:!0,dropdownParent:"#form-banner",children:Object.entries(P).map(([e,n])=>{let i=h.includes(e);return e==="cambia_empresas"&&A!=="home"&&(i=!1),t.jsxs("option",{value:e,children:[n,i?" (Múltiples permitidos)":" (Solo uno)"]},e)})}),t.jsx(f,{eRef:B,label:"Orden",type:"number",col:"col-md-4",defaultValue:0})]})})]})};H((a,x)=>{Y(a).render(t.jsx(J,{...x,title:"Banners",children:t.jsx(te,{...x})}))});
