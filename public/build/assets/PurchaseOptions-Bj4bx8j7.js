var de=Object.defineProperty;var he=(o,r,u)=>r in o?de(o,r,{enumerable:!0,configurable:!0,writable:!0,value:u}):o[r]=u;var P=(o,r,u)=>(he(o,typeof r!="symbol"?r+"":r,u),u);import{j as i}from"./RequirementCard-DEdD30eg.js";import{r as n}from"./index-RYns6xqu.js";import{c as ge}from"./ReactAppend-vpV7VTGG.js";import{B as be}from"./Base-A6Qjm4oP.js";import{r as ve}from"./DxBox-DZgBbgD6.js";import"./sweetalert2.all-DJo0UVK6.js";import{M as je}from"./Modal-IE2ysmSM.js";import{T as xe}from"./Table-BTG--uQT.js";import{I as G}from"./ImageFormGroup-D50xykhM.js";import{I as C}from"./InputFormGroup-B7mKwzkx.js";import{D as J}from"./DxButton-CsjWvhyj.js";import{C as Re}from"./CreateReactScript-BuKYEKxn.js";import{R as K}from"./ReactAppend-DPXaoPQG.js";import{S as Ne}from"./SwitchFormGroup-SB6Qzl6-.js";import{L as Ce}from"./Filter-CpekYgBC.js";import{D as X}from"./DragDropImage-DYciWnuD.js";import{B as ye}from"./Results-BBVbNL2k.js";import{S as we}from"./SelectAPIFormGroupSupport-DzXa28dp.js";import"./index-CXU7o9CY.js";import"./tippy-react.esm-DYFqe69e.js";/* empty css              */import"./Logout-BlWggqgx.js";import"./main-Y8JAyXgE.js";import"./___vite-browser-external_commonjs-proxy-DbMF7jdq.js";import"./index.esm-zkRd-kwu.js";import"./axios-B4uVmeYG.js";import"./useTranslation-CZbMeh78.js";/* empty css               */import"./index-DNUR7M9R.js";class _e extends ye{constructor(){super(...arguments);P(this,"path","admin/purchaseOptions");P(this,"hasFiles",!0)}}const $e=({requirement:o,index:r,onUpdate:u,onRemove:v,onAddCharacteristic:d,onUpdateCharacteristic:y,onRemoveCharacteristic:j})=>i.jsx("div",{className:"card mb-3",children:i.jsxs("div",{className:"card-body",children:[i.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-3",children:[i.jsxs("h6",{children:["Requisito #",r+1]}),i.jsx("button",{type:"button",className:"btn btn-sm btn-outline-danger",onClick:()=>v(r),children:"Eliminar Requisito"})]}),i.jsx(C,{label:"Título del requisito",value:o.title,onChange:p=>u(r,"title",p.target.value)}),i.jsx(X,{current:"purchaseOption",label:"Imagen del requisito",currentImage:o.image,onChange:p=>u(r,"image",p),aspect:16/9}),i.jsxs("div",{className:"mb-3",children:[i.jsx("label",{className:"form-label",children:"Características"}),o.characteristics.map((p,h)=>i.jsxs("div",{className:"input-group mb-2",children:[i.jsx("input",{type:"text",className:"form-control",value:p,onChange:x=>y(r,h,x.target.value)}),i.jsx("button",{type:"button",className:"btn btn-outline-danger",onClick:()=>j(r,h),disabled:o.characteristics.length<=1,children:i.jsx("i",{className:"fa fa-times"})})]},`req-${r}-char-${h}`)),i.jsx("button",{type:"button",className:"btn btn-sm btn-outline-primary",onClick:()=>d(r),children:"Agregar Característica"})]})]})}),M=new _e,Q=({feature:o,index:r,onUpdate:u,onRemove:v,type:d,canRemove:y,characteristics:j,benefits:p,addCharacteristic:h,addBenefit:x})=>{const w=(f,B)=>{u(r,f,B)},D=f=>{u(r,"image",f)};return i.jsx("div",{className:"card mb-3",children:i.jsxs("div",{className:"card-body",children:[i.jsxs("div",{className:"row",children:[i.jsxs("div",{className:"col-md-6",children:[i.jsx(C,{label:"Título",value:o.title,onChange:f=>w("title",f.target.value)}),i.jsxs("div",{className:"mb-3",children:[i.jsx("label",{className:"form-label",children:"Descripción"}),i.jsx("textarea",{className:"form-control",rows:3,value:o.description,onChange:f=>w("description",f.target.value)})]})]}),i.jsx("div",{className:"col-md-6",children:i.jsx(X,{current:"purchaseOption",label:"Imagen",currentImage:o.image,onChange:D,aspect:16/9})})]}),i.jsxs("div",{className:"d-flex justify-content-between",children:[i.jsx("button",{type:"button",className:"btn btn-sm btn-outline-danger",onClick:()=>v(r),disabled:!y,children:"Eliminar"}),d==="characteristic"&&r===j.length-1||d==="benefit"&&r===p.length-1?i.jsxs("button",{type:"button",className:"btn btn-sm btn-outline-primary",onClick:d==="characteristic"?h:x,children:["Agregar"," ",d==="characteristic"?"Característica":"Beneficio"]}):null]})]})})},De=({brands:o})=>{var W;const r=n.useRef(),u=n.useRef(),v=n.useRef(),d=n.useRef(),y=n.useRef(),j=n.useRef(),p=n.useRef(),h=n.useRef(),x=n.useRef(),w=n.useRef(),D=n.useRef(),f=n.useRef(),B=n.useRef(),E=n.useRef(),O=n.useRef(),T=n.useRef(),[Y,H]=n.useState(!1),[A,Z]=n.useState(null),[g,I]=n.useState([{title:"",description:"",image:void 0}]),[b,k]=n.useState([{title:"",description:"",image:void 0}]),[_,R]=n.useState([{title:"",image:void 0,characteristics:[""]}]),[ee,L]=n.useState(""),U=()=>{I([...g,{title:"",description:"",image:void 0}])},ie=n.useCallback((e,s,c)=>{I(l=>{const a=[...l];return a[e]={...a[e],[s]:c},a})},[]),se=e=>{g.length<=1||I(g.filter((s,c)=>c!==e))},z=()=>{k([...b,{title:"",description:"",image:void 0}])},te=n.useCallback((e,s,c)=>{k(l=>{const a=[...l];return a[e]={...a[e],[s]:c},a})},[]),re=e=>{b.length<=1||k(b.filter((s,c)=>c!==e))},ce=()=>{R([..._,{title:"",image:void 0,characteristics:[""]}])},ne=(e,s,c)=>{R(l=>l.map((a,N)=>N===e?{...a,[s]:c}:a))},ae=e=>{_.length<=1||R(_.filter((s,c)=>c!==e))},oe=(e,s,c)=>{R(l=>l.map((a,N)=>{if(N===e){const S=[...a.characteristics];return S[s]=c,{...a,characteristics:S}}return a}))},le=e=>{R(s=>s.map((c,l)=>l===e?{...c,characteristics:[...c.characteristics,""]}:c))},me=(e,s)=>{R(c=>c.map((l,a)=>a===e?{...l,characteristics:l.characteristics.filter((N,S)=>S!==s)}:l))},V=e=>{e!=null&&e.id?H(!0):H(!1),v.current.value=(e==null?void 0:e.id)??"",d.current.value=(e==null?void 0:e.title)??"",y.current.value=(e==null?void 0:e.category.name)??"",L(e==null?void 0:e.category.name),Z(e),j.current.value=(e==null?void 0:e.description)??"",p.current.value=(e==null?void 0:e.how_it_helps)??"",h.current.value=(e==null?void 0:e.description_helps)??"",x.current.value=(e==null?void 0:e.value_proposition)??"",w.current.value=(e==null?void 0:e.innovation_focus)??"",D.current.value=(e==null?void 0:e.customer_relation)??"",f.current.value=(e==null?void 0:e.how_it_requirements)??"",B.current.value=(e==null?void 0:e.description_requirements)??"",E.image.src=`/api/purchaseOption/media/${(e==null?void 0:e.image)??"undefined"}`,O.image.src=`/api/purchaseOption/media/${(e==null?void 0:e.image_secondary)??"undefined"}`,T.image.src=`/api/purchaseOption/media/${(e==null?void 0:e.image_banner)??"undefined"}`,e!=null&&e.characteristics&&I(e.characteristics.map(s=>({title:s.title,description:s.description,image:s.image}))),e!=null&&e.benefits&&k(e.benefits.map(s=>({title:s.title,description:s.description,image:s.image}))),e!=null&&e.requirements&&R(e.requirements.map(s=>({title:s.title||"",image:s.image||void 0,characteristics:s.characteristics||[""]}))),$(u.current).modal("show")},ue=async e=>{e.preventDefault();const s=new FormData,c={id:v.current.value||void 0,title:d.current.value,description:j.current.value,how_it_helps:p.current.value,description_helps:h.current.value,value_proposition:x.current.value,innovation_focus:w.current.value,customer_relation:D.current.value,how_it_requirements:f.current.value,description_requirements:B.current.value};for(const t in c)s.append(t,c[t]);const l=E.current.files[0];l&&s.append("image",l);const a=O.current.files[0];a&&s.append("image_secondary",a);const N=T.current.files[0];N&&s.append("image_banner",N),g.forEach((t,m)=>{s.append(`characteristics[${m}][title]`,t.title),s.append(`characteristics[${m}][description]`,t.description),t.image&&(t.image.file?s.append(`characteristics[${m}][image]`,t.image.file):typeof t.image=="string"&&s.append(`characteristics[${m}][existing_image]`,t.image))}),b.forEach((t,m)=>{s.append(`benefits[${m}][title]`,t.title),s.append(`benefits[${m}][description]`,t.description),t.image&&(t.image.file?s.append(`benefits[${m}][image]`,t.image.file):typeof t.image=="string"&&s.append(`benefits[${m}][existing_image]`,t.image))}),_.map((t,m)=>{var q;const F={title:t.title,characteristics:t.characteristics.filter(fe=>fe.trim()!=="")};return(q=t.image)!=null&&q.file?s.append(`requirements[${m}][image]`,t.image.file):typeof t.image=="string"&&(F.image=t.image),F}).forEach((t,m)=>{s.append(`requirements[${m}][title]`,t.title),t.image&&(typeof t.image=="object"&&t.image.file?s.append(`requirements[${m}][image]`,t.image.file):typeof t.image=="string"&&s.append(`requirements[${m}][existing_image]`,t.image)),t.characteristics.forEach((F,q)=>{s.append(`requirements[${m}][characteristics][${q}]`,F)})}),s.append("category_name",ee),await M.save(s)&&($(r.current).dxDataGrid("instance").refresh(),$(u.current).modal("hide"))},pe=async({id:e,field:s,value:c})=>{await M.boolean({id:e,field:s,value:c})&&$(r.current).dxDataGrid("instance").refresh()};return i.jsxs(i.Fragment,{children:[i.jsx(xe,{gridRef:r,title:"Opciones de compra",rest:M,toolBar:e=>{e.unshift({widget:"dxButton",location:"after",options:{icon:"refresh",hint:"Refrescar tabla",onClick:()=>$(r.current).dxDataGrid("instance").refresh()}}),e.unshift({widget:"dxButton",location:"after",options:{icon:"plus",text:"Agregar",hint:"Agregar nueva opción de compra",onClick:()=>V()}})},columns:[{dataField:"id",caption:"ID",visible:!1},{dataField:"title",caption:"Título",width:"200px"},{dataField:"description",caption:"Descripción",cellTemplate:(e,{data:s})=>{e.html(ve(i.jsx("div",{className:"text-truncate",style:{maxWidth:"300px"},children:s.description})))}},{dataField:"image",caption:"Imagen",width:"100px",cellTemplate:(e,{data:s})=>{K(e,i.jsx("img",{src:`/api/purchaseOption/media/${s.image}`,style:{width:"80px",height:"45px",objectFit:"cover",borderRadius:"4px"},onError:c=>c.target.src="/images/default-thumbnail.jpg"}))}},{dataField:"featured",caption:"Destacado",dataType:"boolean",width:"80px",cellTemplate:(e,{data:s})=>{K(e,i.jsx(Ne,{checked:s.featured,onChange:c=>pe({id:s.id,field:"featured",value:c.target.checked})}))}},{caption:"Acciones",width:"100px",cellTemplate:(e,{data:s})=>{e.append(J({className:"btn btn-xs btn-soft-primary me-1",title:"Editar",icon:"fa fa-pen",onClick:()=>V(s)})),e.append(J({className:"btn btn-xs btn-soft-danger",title:"Eliminar",icon:"fa fa-trash",onClick:()=>onDeleteClicked(s.id)}))}}]}),i.jsxs(je,{modalRef:u,title:Y?"Editar Opción de Compra":"Nueva Opción de Compra",onSubmit:ue,size:"lg",children:[i.jsx("input",{ref:v,type:"hidden"}),i.jsxs("div",{className:"row",children:[i.jsxs("div",{className:"col-md-6",id:"purchase-container",children:[i.jsx(we,{eRef:y,dropdownParent:"#purchase-container",label:"Categoría",searchAPI:"/api/admin/category_purcharse_options/paginate",searchBy:"name",allowCreate:!0,onChange:e=>L(e),initialValue:((W=A==null?void 0:A.category)==null?void 0:W.name)||""}),i.jsx(C,{eRef:d,label:"Título de la opción de compra",required:!0}),i.jsxs("div",{className:"mb-3",children:[i.jsx("label",{className:"form-label",children:"Descripción"}),i.jsx("textarea",{ref:j,className:"form-control",rows:4,required:!0})]})]}),i.jsxs("div",{className:"col-md-6",children:[i.jsx(C,{eRef:p,label:"Cómo ayuda"}),i.jsxs("div",{className:"mb-3",children:[i.jsx("label",{className:"form-label",children:"Descripción de ayuda"}),i.jsx("textarea",{ref:h,className:"form-control",rows:4})]})]})]}),i.jsxs("div",{className:"row mt-3",children:[i.jsx("div",{className:"col-md-6",children:i.jsx(G,{eRef:E,label:"Imagen principal",aspect:16/9})}),i.jsx("div",{className:"col-md-6",children:i.jsx(G,{eRef:O,label:"Imagen secundaria",aspect:16/9})}),i.jsx("div",{className:"col-md-12 mt-3",children:i.jsx(G,{eRef:T,label:"Banner",aspect:16/9})})]}),i.jsx("div",{className:"row mt-3",children:i.jsxs("div",{className:"col-12",children:[i.jsx(C,{eRef:x,label:"Propuesta de valor"}),i.jsx("h5",{className:"mb-3",children:"Características"}),g.map((e,s)=>i.jsx(Q,{feature:e,index:s,onUpdate:ie,onRemove:se,canRemove:g.length>1,type:"characteristic",characteristics:g,benefits:b,addCharacteristic:U,addBenefit:z},`char-${s}`))]})}),i.jsxs("div",{className:"row mt-3",children:[i.jsx("div",{className:"col-md-6",children:i.jsx(C,{eRef:w,label:"Enfoque de innovación"})}),i.jsx("div",{className:"col-md-6",children:i.jsxs("div",{className:"mb-3",children:[i.jsx("label",{className:"form-label",children:"Relación con el cliente"}),i.jsx("textarea",{ref:D,className:"form-control",rows:5})]})}),i.jsxs("div",{className:"col-md-12",children:[i.jsx("h5",{className:"mb-3 mt-4",children:"Beneficios"}),b.map((e,s)=>i.jsx(Q,{feature:e,index:s,onUpdate:te,onRemove:re,canRemove:b.length>1,type:"benefit",characteristics:g,benefits:b,addCharacteristic:U,addBenefit:z},`benefit-${s}`))]})]}),i.jsx("div",{className:"row mt-3",children:i.jsxs("div",{className:"col-12",children:[i.jsx("h5",{className:"mb-3",children:"Requisitos"}),i.jsxs("div",{className:"mb-3",children:[i.jsx(C,{eRef:f,label:"Cómo funciona los requisitos"}),i.jsxs("div",{className:"mb-3",children:[i.jsx("label",{className:"form-label",children:"Descripción de requisitos"}),i.jsx("textarea",{ref:B,className:"form-control",rows:4})]})]}),_&&_.map((e,s)=>i.jsx($e,{requirement:e,index:s,onUpdate:ne,onRemove:ae,onAddCharacteristic:le,onUpdateCharacteristic:oe,onRemoveCharacteristic:me},`requirement-${s}`)),i.jsxs("button",{type:"button",className:"btn btn-primary mt-2",onClick:ce,children:[i.jsx("i",{className:"fa fa-plus me-2"})," Agregar Requisito"]})]})})]})]})};Re((o,r)=>{ge(o).render(i.jsx(Ce,{children:i.jsx(be,{...r,title:"Opción de Compras",children:i.jsx(De,{...r})})}))});
