var Y=Object.defineProperty;var Z=(d,i,t)=>i in d?Y(d,i,{enumerable:!0,configurable:!0,writable:!0,value:t}):d[i]=t;var F=(d,i,t)=>(Z(d,typeof i!="symbol"?i+"":i,t),t);import{j as e}from"./FileViewer-CpM0iYLI.js";import{r as l}from"./index-B80Lgev0.js";import{c as _}from"./ReactAppend-CBRQCQGz.js";import{B as ee}from"./Base-CiApDJ7F.js";import{C as se}from"./CreateReactScript-Bj11ghWz.js";import{M as re}from"./Modal-Dyq34CHD.js";import{I as P}from"./InputFormGroup-DZ3W53Mr.js";import{S as ie}from"./SwitchFormGroup-ChGOZLEW.js";import{I as ne}from"./ImageFormGroup-BhK-m0pl.js";import"./sweetalert2.all-Dh0rZL5X.js";import{T as te}from"./TextareaFormGroup-BKhRBaxf.js";import{V as oe}from"./VideoFormGroup-Djxhe91E.js";import{m as x}from"./main-Br9xqDfn.js";import{B as ce}from"./Results-B9dLaNz0.js";import"./index-DO3Aws4m.js";import"./tippy-react.esm-CHhA99mn.js";/* empty css              */import"./Logout-Cj6nvmS-.js";import"./index.esm-CTa_PdWD.js";import"./axios-B4uVmeYG.js";import"./___vite-browser-external_commonjs-proxy-C9-083JZ.js";import"./useTranslation-BvL_iu_4.js";import"./Filter-1mRNSgu6.js";/* empty css               */class le extends ce{constructor(){super(...arguments);F(this,"path","admin/landing_home");F(this,"hasFiles",!0);F(this,"translate",async t=>{try{const{status:p,result:m}=await x.Fetch(`/api/${this.path}/translate`,{method:"POST",body:JSON.stringify(t)});if(!p)throw new Error((m==null?void 0:m.message)||"Error al guardar traducción");return m}catch(p){return x.Notify.error(p.message),null}});F(this,"getByLang",async t=>{try{const{status:p,result:m}=await x.Fetch(`/api/${this.path}/by_lang/${t}`);if(!p)throw new Error((m==null?void 0:m.message)||"Error al obtener traducciones");return m}catch(p){return x.Notify.error(p.message),null}})}}const O=new le,ae=d=>{if(!d)return"home";const i=d.split("_");return i.length<2?"home":i[1]},q=({data:d,field:i,currentLangId:t,defaultLangId:p,onSave:m})=>{const[C,N]=l.useState(d[i]||""),[V,y]=l.useState(!1),S=t===p,j=!S,A=()=>{m(i,C),y(!1)};return e.jsx("div",{className:`d-flex gap-2 align-items-center ${j?"translation-field":""}`,children:S?e.jsx("span",{children:d[i]}):e.jsxs(e.Fragment,{children:[e.jsx("input",{className:"form-control flex-grow-1",value:C,onChange:g=>{N(g.target.value),y(!0)},disabled:!j}),V&&j&&e.jsx("button",{className:"btn btn-xs btn-soft-primary",onClick:A,children:e.jsx("i",{className:"fa fa-save"})})]})})},de=({items:d,current_lang_id:i,default_lang_id:t})=>{const p=l.useRef(),[m,C]=l.useState("home"),[N,V]=l.useState(!1),[y,S]=l.useState(!1),[j,A]=l.useState(d),[g,z]=l.useState({}),[Q,U]=l.useState(!1),R=l.useRef(null),I=l.useRef(null),k=l.useRef(null),E=l.useRef(null),w=l.useRef(null),T=l.useRef(null),L=l.useRef(null),B=l.useRef(null),M={home:"Inicio",services:"Servicios",aboutus:"Nosotros",facility:"Sedes",contact:"Contacto",blog:"Blog"};l.useEffect(()=>{(async()=>{if(i!==t){U(!0);try{const n=await O.getByLang(i),c={};n.forEach(r=>{r.original_id&&(c[r.original_id]=r)}),z(c)}catch(n){x.Notify.error("Error al cargar traducciones"),console.error("Error loading translations:",n)}finally{U(!1)}}else z({})})()},[i,t]);const b=j.reduce((s,n)=>{const c=ae(n.correlative);s[c]||(s[c]=[]);const r=g[n.original_id||n.id]||{},h={...n,title:i!==t&&r.title||n.title,subtitle:i!==t&&r.subtitle||n.subtitle,description:i!==t&&r.description||n.description,link:i!==t&&r.link||n.link,is_translated:!!r.id};return s[c].push(h),s},{});l.useEffect(()=>{var s;console.log("Items agrupados:",b),console.log("Items en home:",(s=b.home)==null?void 0:s.length)},[b]);const W=s=>{s!=null&&s.id?V(!0):V(!1),setTimeout(()=>{R.current&&(R.current.value=(s==null?void 0:s.id)??""),I.current&&(I.current.value=(s==null?void 0:s.title)??""),k.current&&(k.current.value=(s==null?void 0:s.subtitle)??""),E.current&&(E.current.value=(s==null?void 0:s.description)??""),L.current&&(L.current.value=(s==null?void 0:s.link)??"");const n=(s==null?void 0:s.is_video)==="1"||(s==null?void 0:s.is_video)===1;B.current&&(B.current.checked=n,S(n)),n&&T.current&&(s!=null&&s.video)?T.current.setVideoSrc(`/api/landing_home/video/${s.video}`):w.current&&(s!=null&&s.image)&&(w.current.src=`/api/landing_home/media/${s==null?void 0:s.image}`)},100),$(p.current).modal("show")},X=async s=>{var n,c,r,h,a,f,o,H;s.preventDefault();try{const u=new FormData;if((n=R.current)!=null&&n.value&&u.append("id",R.current.value),(c=I.current)!=null&&c.value&&u.append("title",I.current.value),(r=k.current)!=null&&r.value&&u.append("subtitle",k.current.value),(h=E.current)!=null&&h.value&&u.append("description",E.current.value),(a=L.current)!=null&&a.value&&u.append("link",L.current.value),u.append("is_video",(f=B.current)!=null&&f.checked?"1":"0"),u.append("lang_id",t),y&&T.current){const K=T.current.getFile();K&&u.append("video",K)}else(H=(o=w.current)==null?void 0:o.files)!=null&&H[0]&&u.append("image",w.current.files[0]);if(!await O.save(u))return;const v=await O.getAll();v&&A(v),$(p.current).modal("hide"),x.Notify.success("Sección guardada correctamente")}catch(u){console.error("Error al enviar el formulario:",u),x.Notify.error("Hubo un error al enviar el formulario")}},D=async(s,n,c)=>{var r,h,a,f;try{const o=j.find(G=>G.id===s);if(!o)return;const H={original_id:o.original_id||o.id,[n]:c,lang_id:i,title:n==="title"?c:((r=g[o.id])==null?void 0:r.title)||o.title,subtitle:n==="subtitle"?c:((h=g[o.id])==null?void 0:h.subtitle)||o.subtitle,description:n==="description"?c:((a=g[o.id])==null?void 0:a.description)||o.description,link:n==="link"?c:((f=g[o.id])==null?void 0:f.link)||o.link},u=await O.translate(H);if(!u)return;z(G=>{const v={...G};return v[o.id]||(v[o.id]={...o,id:u.id,original_id:o.id,lang_id:i}),v[o.id][n]=c,v}),x.Notify.success("Traducción guardada correctamente")}catch(o){x.Notify.error("Error al guardar traducción"),console.error(o)}},J=i!==t;return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:`card ${J?"translation-mode":""}`,children:[e.jsxs("div",{className:"card-header d-flex justify-content-between align-items-center",children:[e.jsx("ul",{className:"nav nav-tabs card-header-tabs",children:Object.keys(M).map(s=>e.jsx("li",{className:"nav-item",children:e.jsx("button",{className:`nav-link ${m===s?"active":""}`,onClick:()=>C(s),children:M[s]})},s))}),e.jsx("div",{className:"d-flex align-items-center gap-2",children:J&&e.jsxs("span",{className:"badge bg-success me-2",style:{padding:"6px"},children:[e.jsx("i",{className:"fa fa-language me-1"})," Modo Traducción"]})})]}),e.jsx("div",{className:"card-body",children:Q?e.jsxs("div",{className:"text-center py-5",children:[e.jsx("div",{className:"spinner-border text-primary",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Cargando..."})}),e.jsx("p",{className:"mt-2",children:"Cargando traducciones..."})]}):Object.keys(M).map(s=>{var n,c;return e.jsxs("div",{style:{display:m===s?"block":"none"},children:[e.jsxs("h4",{className:"mb-4",children:["Secciones de ",M[s]]}),e.jsxs("p",{className:"text-muted mb-3",children:["Mostrando ",((n=b[s])==null?void 0:n.length)||0," ","secciones"]}),((c=b[s])==null?void 0:c.length)===0?e.jsx("div",{className:"alert alert-info",children:"No hay secciones configuradas para esta página"}):e.jsx("div",{className:"row",children:(b[s]||[]).map(r=>{var h;return e.jsx("div",{className:"col-md-6 mb-4",children:e.jsxs("div",{className:"card h-100",children:[e.jsx("div",{className:"card-header d-flex justify-content-between align-items-center",children:e.jsxs("h5",{className:"mb-0",children:[((h=r.correlative)==null?void 0:h.split("_")[2])||"Sección",e.jsxs("small",{className:"text-muted ms-2",children:["(",r.correlative,")"]})]})}),e.jsxs("div",{className:"card-body",children:[r.is_video==="1"||r.is_video===1?e.jsx("video",{src:`/api/landing_home/video/${r.video}`,className:"img-fluid mb-3",style:{maxHeight:"200px",width:"100%",objectFit:"cover"},onError:a=>a.target.src="/api/cover/thumbnail/null",controls:!0}):r.image?e.jsx("img",{src:`/api/landing_home/media/${r.image}`,className:"img-fluid mb-3",style:{maxHeight:"200px",width:"100%",objectFit:"cover"},onError:a=>a.target.src="/api/cover/thumbnail/null"}):e.jsx("div",{className:"bg-light mb-3",style:{height:"200px",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx("span",{className:"text-muted",children:"Sin imagen/video"})}),r.title&&e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"Título:"}),e.jsx(q,{data:r,field:"title",currentLangId:i,defaultLangId:t,onSave:(a,f)=>D(r.id,a,f)})]}),r.subtitle&&e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"Subtítulo:"}),e.jsx(q,{data:r,field:"subtitle",currentLangId:i,defaultLangId:t,onSave:(a,f)=>D(r.id,a,f)})]}),r.description&&e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"Descripción:"}),e.jsx(q,{data:r,field:"description",currentLangId:i,defaultLangId:t,onSave:(a,f)=>D(r.id,a,f)})]}),r.link&&e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"Enlace:"}),e.jsx(q,{data:r,field:"link",currentLangId:i,defaultLangId:t,onSave:(a,f)=>D(r.id,a,f)})]})]}),e.jsx("div",{className:"card-footer d-flex justify-content-end",children:e.jsxs("button",{className:"btn btn-sm btn-outline-primary me-2",onClick:()=>W(r),disabled:J,children:[e.jsx("i",{className:"fa fa-edit"})," ","Editar"]})})]})},r.id)})})]},s)})})]}),e.jsx(re,{modalRef:p,title:N?"Editar sección":"Agregar sección",onSubmit:X,size:"lg",children:e.jsxs("div",{className:"row",id:"principal-container",children:[e.jsx("input",{ref:R,type:"hidden"}),e.jsxs("div",{className:"col-md-6",children:[e.jsx(P,{eRef:I,label:"Título",placeholder:"Título principal de la sección",required:!0}),e.jsx(P,{eRef:k,label:"Subtítulo",placeholder:"Subtítulo opcional"}),e.jsx(te,{eRef:E,label:"Descripción",rows:3,placeholder:"Descripción detallada de la sección"}),e.jsx(P,{eRef:L,label:"Enlace",placeholder:"https://ejemplo.com"})]}),e.jsxs("div",{className:"col-md-6",children:[e.jsx(ie,{eRef:B,onChange:s=>S(s.target.checked),label:"Usar video en lugar de imagen",specification:"Solo se mostrará el video en la sección"}),y?e.jsx(oe,{eRef:T,label:"Video",col:"col-12",required:!N}):e.jsx(ne,{eRef:w,label:"Imagen",col:"col-12",aspect:16/9,fit:"contain",required:!N})]})]})})]})};se((d,i)=>{_(d).render(e.jsx(ee,{...i,title:"Landing Inicio",children:e.jsx(de,{...i})}))});
