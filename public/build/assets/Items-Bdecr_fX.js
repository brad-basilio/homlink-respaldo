import{j as t}from"./FileViewer-CpM0iYLI.js";import{B as Z}from"./Base--EjMhvqW.js";import{S as f}from"./SwitchFormGroup-ChGOZLEW.js";import{r as s}from"./index-B80Lgev0.js";import{c as ee}from"./ReactAppend-CBRQCQGz.js";import{r as T}from"./DxBox-CdMuSyGE.js";import{S as re}from"./sweetalert2.all-Dh0rZL5X.js";import{I as te}from"./ItemsRest-ZqEvhwe2.js";import{M as le}from"./Modal-CbHkO7Dn.js";import{T as ie}from"./Table-CEq6jy84.js";import{I as se}from"./ImageFormGroup-BhK-m0pl.js";import{I as g}from"./InputFormGroup-DZ3W53Mr.js";import"./main-Br9xqDfn.js";import{S as O}from"./SelectFormGroup-9bKziFRR.js";import{D as q}from"./DxButton-CsjWvhyj.js";import{C as ne}from"./CreateReactScript-Bj11ghWz.js";import{N as P}from"./Number2Currency-e57Tgsuk.js";import{R as p}from"./ReactAppend-C-tNgxIf.js";import"./tippy-react.esm-CHhA99mn.js";import"./index-DO3Aws4m.js";/* empty css              */import"./Logout-Cj6nvmS-.js";import"./index.esm-CTa_PdWD.js";import"./axios-B4uVmeYG.js";import"./___vite-browser-external_commonjs-proxy-C9-083JZ.js";import"./useTranslation-BvL_iu_4.js";import"./Filter-1mRNSgu6.js";import"./Results-B9dLaNz0.js";/* empty css               */const h=new te,oe=({categories:y,brands:R})=>{const[x,L]=s.useState([]),m=s.useRef(),w=s.useRef(),C=s.useRef(),D=s.useRef(),N=s.useRef(),k=s.useRef(),d=s.useRef(),c=s.useRef(),b=s.useRef(),I=s.useRef(),S=s.useRef(),F=s.useRef(),[M,E]=s.useState(!1),[ae,U]=s.useState(null),[ce,z]=s.useState(null),[v,a]=s.useState([]),G=s.useRef(),V=e=>{const l=Array.from(e.target.files).map(i=>({file:i,url:URL.createObjectURL(i)}));a(i=>[...i,...l])},J=e=>{e.preventDefault();const l=Array.from(e.dataTransfer.files).map(i=>({file:i,url:URL.createObjectURL(i)}));a(i=>[...i,...l])},H=e=>{e.preventDefault()},K=(e,r)=>{e.preventDefault(),v[r].id?a(i=>i.map((o,u)=>u===r?{...o,toDelete:!0}:o)):a(i=>i.filter((o,u)=>u!==r))};s.useEffect(()=>{if(x&&x.images){const e=x.images.map(r=>({id:r.id,url:`/api/items/media/${r.url}`}));a(e)}},[x]);const _=e=>{if(L(e||null),e!=null&&e.id?E(!0):E(!1),C.current.value=(e==null?void 0:e.id)||"",$(D.current).val((e==null?void 0:e.category_id)||null).trigger("change"),N.current.value=(e==null?void 0:e.name)||"",k.current.value=(e==null?void 0:e.summary)||"",d.current.value=(e==null?void 0:e.price)||0,c.current.value=(e==null?void 0:e.discount)||0,$(S.current).val((e==null?void 0:e.score)||null).trigger("change"),b.current.value=null,b.image.src=`/api/items/media/${(e==null?void 0:e.image)??"undefined"}`,I.current.value=(e==null?void 0:e.description)??"",e!=null&&e.images){const r=e.images.map(l=>({id:l.id,url:`/api/items/media/${l.url}`}));a(r)}else a([]);F.current.value=e==null?void 0:e.stock,$(w.current).modal("show")},Q=async e=>{e.preventDefault();let r=0,l=0;c.current.value&&c.current.value>0?(r=c.current.value,l=100-c.current.value*100/d.current.value):(r=d.current.value,l=0);const i={id:C.current.value||void 0,category_id:D.current.value,name:N.current.value,summary:k.current.value,price:d.current.value,discount:c.current.value,description:I.current.value,sotck:F.current.value,score:S.current.value,final_price:r,discount_percent:l},o=new FormData;for(const n in i)o.append(n,i[n]);const u=b.current.files[0];u&&o.append("image",u),v.forEach((n,A)=>{n.toDelete||(n.file?o.append(`gallery[${A}]`,n.file):o.append(`gallery_ids[${A}]`,n.id))});const B=v.filter(n=>n.toDelete).map(n=>parseInt(n.id,10));B.length>0&&o.append("deleted_images",JSON.stringify(B)),await h.save(o)&&($(m.current).dxDataGrid("instance").refresh(),$(w.current).modal("hide"),a([]))},W=async({id:e,value:r})=>{await h.boolean({id:e,field:"visible",value:r})&&$(m.current).dxDataGrid("instance").refresh()},j=async({id:e,field:r,value:l})=>{await h.boolean({id:e,field:r,value:l})&&$(m.current).dxDataGrid("instance").refresh()},X=async e=>{const{isConfirmed:r}=await re.fire({title:"Eliminar Item",text:"¿Estás seguro de eliminar este item?",icon:"warning",showCancelButton:!0,confirmButtonText:"Sí, eliminar",cancelButtonText:"Cancelar"});!r||!await h.delete(e)||$(m.current).dxDataGrid("instance").refresh()},Y=[{value:1,label:"1"},{value:2,label:"2"},{value:3,label:"3"},{value:4,label:"4"},{value:5,label:"5"}];return t.jsxs(t.Fragment,{children:[t.jsx(ie,{gridRef:m,title:"Items",rest:h,toolBar:e=>{e.unshift({widget:"dxButton",location:"after",options:{icon:"refresh",hint:"Refrescar tabla",onClick:()=>$(m.current).dxDataGrid("instance").refresh()}}),e.unshift({widget:"dxButton",location:"after",options:{icon:"plus",text:"Agregar",hint:"Agregar",onClick:()=>_()}})},exportable:!0,exportableName:"Items",columns:[{dataField:"id",caption:"ID",visible:!1},{dataField:"category.name",caption:"Categoría",width:"120px",cellTemplate:(e,{data:r})=>{var l,i;e.html(T(t.jsxs(t.Fragment,{children:[t.jsx("b",{className:"d-block",children:(l=r.category)==null?void 0:l.name}),t.jsx("small",{className:"text-muted",children:(i=r.subcategory)==null?void 0:i.name})]})))}},{dataField:"category.name",caption:"Categoria",visible:!1},{dataField:"name",caption:"Nombre",width:"300px",cellTemplate:(e,{data:r})=>{e.html(T(t.jsxs(t.Fragment,{children:[t.jsx("b",{children:r.name}),t.jsx("br",{}),t.jsx("span",{className:"truncate",children:r.summary})]})))}},{dataField:"final_price",caption:"Precio",dataType:"number",width:"75px",cellTemplate:(e,{data:r})=>{e.html(T(t.jsxs(t.Fragment,{children:[r.discount>0&&t.jsxs("small",{className:"d-block text-muted",style:{textDecoration:"line-through"},children:["S/.",P(r.price)]}),t.jsxs("span",{children:["S/.",P(r.discount>0?r.discount:r.price)]})]})))}},{dataField:"image",caption:"Imagen",width:"90px",allowFiltering:!1,cellTemplate:(e,{data:r})=>{p(e,t.jsx("img",{src:`/api/items/media/${r.image}`,style:{width:"80px",height:"48px",objectFit:"cover",objectPosition:"center",borderRadius:"4px"},onError:l=>l.target.src="/api/cover/thumbnail/null"}))}},{dataField:"is_new",caption:"Nuevo",dataType:"boolean",width:"80px",cellTemplate:(e,{data:r})=>{p(e,t.jsx(f,{checked:r.is_new,onChange:l=>j({id:r.id,field:"is_new",value:l.target.checked})}))}},{dataField:"offering",caption:"En oferta",dataType:"boolean",width:"80px",cellTemplate:(e,{data:r})=>{p(e,t.jsx(f,{checked:r.offering,onChange:l=>j({id:r.id,field:"offering",value:l.target.checked})}))}},{dataField:"recommended",caption:"Recomendado",dataType:"boolean",width:"80px",cellTemplate:(e,{data:r})=>{p(e,t.jsx(f,{checked:r.recommended,onChange:l=>j({id:r.id,field:"recommended",value:l.target.checked})}))}},{dataField:"featured",caption:"Destacado",dataType:"boolean",width:"80px",cellTemplate:(e,{data:r})=>{p(e,t.jsx(f,{checked:r.featured,onChange:l=>j({id:r.id,field:"featured",value:l.target.checked})}))}},{dataField:"visible",caption:"Visible",dataType:"boolean",width:"80px",cellTemplate:(e,{data:r})=>{p(e,t.jsx(f,{checked:r.visible,onChange:l=>W({id:r.id,value:l.target.checked})}))}},{caption:"Acciones",width:"100px",cellTemplate:(e,{data:r})=>{e.css("text-overflow","unset"),e.append(q({className:"btn btn-xs btn-soft-primary",title:"Editar",icon:"fa fa-pen",onClick:()=>_(r)})),e.append(q({className:"btn btn-xs btn-soft-danger",title:"Eliminar",icon:"fa fa-trash",onClick:()=>X(r.id)}))},allowFiltering:!1,allowExporting:!1}]}),t.jsxs(le,{modalRef:w,title:M?"Editar Item":"Agregar Item",onSubmit:Q,size:"xl",children:[t.jsxs("div",{className:"row",id:"principal-container",children:[t.jsx("input",{ref:C,type:"hidden"}),t.jsxs("div",{className:"col-md-6",children:[t.jsx(g,{eRef:N,label:"Nombre",required:!0}),t.jsx(g,{eRef:k,label:"Resumen"}),t.jsx(O,{eRef:D,label:"Categoría",required:!0,dropdownParent:"#principal-container",onChange:e=>U(e.target.value),children:y.map((e,r)=>t.jsx("option",{value:e.id,children:e.name},r))}),t.jsx(g,{label:"Stock",eRef:F,type:"number"}),t.jsx(g,{eRef:d,label:"Precio",type:"number",step:"0.01",required:!0}),t.jsx(g,{eRef:c,label:"Descuento",type:"number",step:"0.01"}),t.jsx(O,{eRef:S,label:"Calificación",required:!0,dropdownParent:"#principal-container",onChange:e=>z(e.target.value),children:Y.map((e,r)=>t.jsx("option",{value:e.value,children:e.label},r))})]}),t.jsx("div",{className:"col-md-6",children:t.jsxs("div",{className:"row",children:[t.jsx(se,{eRef:b,label:"Imagen",aspect:1,col:"col-lg-6 col-md-12 col-sm-6"}),t.jsxs("div",{className:"col-lg-6 col-md-12 col-sm-6",children:[t.jsx("label",{className:"form-label",children:"Galeria"}),t.jsx("input",{id:"input-item-gallery",ref:G,type:"file",multiple:!0,accept:"image/*",hidden:!0,onChange:V}),t.jsx("div",{style:{border:"2px dashed #ccc",padding:"20px",textAlign:"center",cursor:"pointer",borderRadius:"4px",boxShadow:"2.5px 2.5px 5px rgba(0,0,0,.125)",aspectRatio:"21/9",height:"254px",width:"100%",display:"flex",alignItems:"center",justifyContent:"center"},onClick:()=>G.current.click(),onDrop:J,onDragOver:H,children:t.jsx("span",{className:"form-label d-block mb-1",children:"Arrastra y suelta imágenes aquí o haz clic para agregar"})})]}),t.jsx("div",{className:"col-md-12 col-sm-12",children:t.jsx("div",{className:"d-flex flex-wrap gap-1  mt-2",children:v.map((e,r)=>t.jsxs("div",{className:"position-relative",style:{width:"80px",height:"80px"},children:[t.jsx("img",{src:`${e.url}`,alt:"preview",style:{width:"100%",height:"100%",objectFit:"cover",borderRadius:"4px"}}),t.jsx("button",{className:"btn btn-xs btn-danger position-absolute",style:{top:0,right:0},onClick:l=>K(l,r),children:"×"})]},r))})})]})})]}),t.jsx("hr",{className:"my-1"}),t.jsx("label",{className:"form-label",children:"Descripción"}),t.jsx("textarea",{ref:I,className:"form-control",placeholder:"Descripción"})]})]})};ne((y,R)=>{ee(y).render(t.jsx(Z,{...R,title:"Items",children:t.jsx(oe,{...R})}))});
