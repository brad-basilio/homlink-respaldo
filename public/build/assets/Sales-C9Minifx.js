import{j as e}from"./RequirementCard-DEdD30eg.js";import{r as o}from"./index-RYns6xqu.js";import{c as E}from"./ReactAppend-vpV7VTGG.js";import{C as F,e as D,T as A,R as S,af as w,G as C,a8 as l,D as _,M as P,an as B,ao as z}from"./CreateReactScript-C-mUikVe.js";import{S as M}from"./sweetalert2.all-DJo0UVK6.js";import{r as O}from"./DxBox-DZgBbgD6.js";import"./index-CXU7o9CY.js";import"./Filter-BDLE8FWR.js";import"./axios-B4uVmeYG.js";import"./TippyButton-Duhaw_sS.js";import"./DataGrid-Cd7cnf9r.js";import"./___vite-browser-external_commonjs-proxy-DbMF7jdq.js";import"./MenuItem-CBKDeUjr.js";import"./Results-CoLI09XT.js";import"./TinyMCEFormGroup-TcwoFScW.js";import"./index-DNUR7M9R.js";import"./Detail-BKcVR7Sx.js";import"./index-SDlHnhXR.js";import"./HomeSeccionBlog-CZ04iwe8.js";import"./CarruselBrands-Chpi1Apc.js";import"./Strengths-8rnVxSkq.js";import"./ModalAppointment-BjEduSb5.js";import"./CallToAction-3RvJBMpr.js";import"./WeCupSection-CkKcxXUy.js";import"./BlurText-Cr9yZ_QA.js";import"./Supplies-DJwkpyzw.js";import"./Banner-CXqQ-nCn.js";import"./HeroSecctionEmpresa-Bs7Po8J9.js";import"./WhatsAppModal-BCTi89gL.js";const d=new B,Y=new z,G=({statuses:x})=>{var N,y,v,g;const n=o.useRef(),j=o.useRef(),[t,b]=o.useState(null),[h,u]=o.useState([]),k=async r=>{const s=await d.save({id:t.id,status_id:r.target.value});s&&(b(s.data),$(n.current).dxDataGrid("instance").refresh())},R=async r=>{const{isConfirmed:s}=await M.fire({title:"Anular pedido",text:"¿Estas seguro de anular este pedido?",icon:"warning",showCancelButton:!0,confirmButtonText:"Si, anular",cancelButtonText:"Cancelar"});!s||!await d.delete(r)||$(n.current).dxDataGrid("instance").refresh()},f=async r=>{u([]);const s=await d.get(r);console.log(s),b(s.data),$(j.current).modal("show")};o.useEffect(()=>{t&&Y.bySale(t.id).then(r=>{u(r||[])})},[t]);const T=Number(t==null?void 0:t.amount)+Number(t==null?void 0:t.delivery)-Number(t==null?void 0:t.coupon_discount);return e.jsxs(e.Fragment,{children:[e.jsx(A,{gridRef:n,title:"Pedidos",rest:d,toolBar:r=>{r.unshift({widget:"dxButton",location:"after",options:{icon:"refresh",hint:"Refrescar tabla",onClick:()=>$(n.current).dxDataGrid("instance").refresh()}})},pageSize:25,columns:[{dataField:"id",caption:"ID",visible:!1},{dataField:"code",caption:"Numero de orden",visible:!1},{dataField:"name",caption:"Orden",width:"250px",cellTemplate:(r,{data:s})=>{r.css("cursor","pointer"),r.on("click",()=>{f(s.id)}),S(r,e.jsxs("p",{className:"mb-0",style:{width:"100%"},children:[e.jsxs("b",{className:"d-block",children:[s.renewal&&e.jsx(w,{content:`Plan: ${s.renewal.name}`,children:e.jsx("i",{className:"fa fas fa-spa text-pink me-1"})}),s.name," ",s.lastname]}),e.jsxs("small",{className:"text-nowrap text-muted",style:{overflow:"hidden",display:"-webkit-box",WebkitBoxOrient:"vertical",WebkitLineClamp:2,fontFamily:"monospace"},children:["#",C.APP_CORRELATIVE,"-",s.code]})]}))}},{dataField:"created_at",caption:"Fecha",dataType:"date",sortOrder:"desc",cellTemplate:(r,{data:s})=>{r.html(O(e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"d-block",children:moment(s.created_at.replace("Z","-05:00")).fromNow()}),e.jsx("small",{className:"d-block text-muted",children:moment(s.created_at).format("lll")})]})))}},{dataField:"status.name",caption:"Estado",cellTemplate:(r,{data:s})=>{S(r,e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"badge rounded-pill",style:{backgroundColor:s.status.color?`${s.status.color}2e`:"#3333332e",color:s.status.color??"#333"},children:s.status.name}),e.jsx("small",{className:"d-block text-muted",children:s.status.description})]}))}},{dataField:"amount",caption:"Total",dataType:"number",cellTemplate:(r,{data:s})=>{const c=Number(s.amount)||0,a=Number(s.delivery)||0,i=Number(s.bundle_discount)||0,m=Number(s.renewal_discount)||0,p=Number(s.coupon_discount)||0;r.text(`S/. ${l(c+a-i-m-p)}`)}},{caption:"Acciones",cellTemplate:(r,{data:s})=>{r.append(_({className:"btn btn-xs btn-light",title:"Ver pedido",icon:"fa fa-eye",onClick:()=>f(s.id)})),r.append(_({className:"btn btn-xs btn-soft-danger",title:"Anular pedido",icon:"fa fa-trash",onClick:()=>R(s.id)}))},allowFiltering:!1,allowExporting:!1}]}),e.jsx(P,{modalRef:j,title:`Detalles del pedido #${C.APP_CORRELATIVE}-${t==null?void 0:t.code}`,size:"lg",bodyStyle:{backgroundColor:"#ebeff2"},hideButtonSubmit:!0,children:e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"col-md-8",children:[e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header p-2",children:e.jsxs("h5",{className:"card-title mb-0",children:["Detalles de Venta - Codigo de transaccion Mercado Pago: ",`${t==null?void 0:t.culqi_charge_id}`]})}),e.jsxs("div",{className:"card-body p-2",children:[e.jsx("table",{id:"table-info",className:"table table-borderless table-sm",children:e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("th",{children:"Nombres:"}),e.jsxs("td",{children:[t==null?void 0:t.name," ",t==null?void 0:t.lastname]})]}),e.jsxs("tr",{children:[e.jsx("th",{children:"Email:"}),e.jsx("td",{children:t==null?void 0:t.email})]}),e.jsxs("tr",{children:[e.jsx("th",{children:"Teléfono:"}),e.jsx("td",{children:t==null?void 0:t.phone})]}),e.jsxs("tr",{children:[e.jsx("th",{children:"Dirección:"}),e.jsxs("td",{children:[t==null?void 0:t.address," ",t==null?void 0:t.number,e.jsxs("small",{className:"text-muted d-block",children:[(t==null?void 0:t.province)??(t==null?void 0:t.district),", ",t==null?void 0:t.department,","," ",t==null?void 0:t.country," ",(t==null?void 0:t.zip_code)&&e.jsxs(e.Fragment,{children:["-"," ",t==null?void 0:t.zip_code]})]})]})]}),(t==null?void 0:t.reference)&&e.jsxs("tr",{children:[e.jsx("th",{children:"Referencia:"}),e.jsx("td",{children:t==null?void 0:t.reference})]})]})}),e.jsxs("button",{className:"btn btn-xs btn-dark",type:"button",copy:`Nombres: ${t==null?void 0:t.fullname}
Email: ${t==null?void 0:t.email}
Teléfono: ${t==null?void 0:t.phone}
Dirección: ${t==null?void 0:t.address} ${t==null?void 0:t.number}
_${(t==null?void 0:t.province)??(t==null?void 0:t.district)}, ${t==null?void 0:t.department}, ${t==null?void 0:t.country} ${t!=null&&t.zip_code?`- ${t==null?void 0:t.zip_code}`:""}_`,children:[e.jsx("i",{className:"mdi mdi-content-copy me-1"}),"Copiar"]})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header p-2",children:e.jsx("h5",{className:"card-title mb-0",children:"Artículos"})}),e.jsx("div",{className:"card-body p-2 table-responsive",children:e.jsxs("table",{className:"table table-striped table-bordered table-sm table-hover mb-0",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Nombre"}),e.jsx("th",{children:"Colores"}),e.jsx("th",{children:"Precio"}),e.jsx("th",{children:"Cantidad"}),e.jsx("th",{children:"Subtotal"})]})}),e.jsx("tbody",{children:(N=t==null?void 0:t.details)==null?void 0:N.map((r,s)=>{var i;const c=r.quantity*100/100,a=r.price*r.quantity;return e.jsxs("tr",{children:[e.jsx("td",{children:r.name}),e.jsx("td",{children:(i=r==null?void 0:r.colors)==null?void 0:i.map((m,p)=>e.jsx(w,{content:m.name,children:e.jsx("i",{className:"mdi mdi-circle",style:{color:m.hex,WebkitTextStroke:"1px #808080"}})},p))}),e.jsxs("td",{align:"right",children:["S/"," ",l(r.price)]}),e.jsx("td",{align:"center",children:c}),e.jsxs("td",{align:"right",children:["S/"," ",l(a)]})]},s)})})]})})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header p-2",children:e.jsx("h5",{className:"card-title mb-0",children:"Resumen"})}),e.jsxs("div",{className:"card-body p-2",children:[e.jsxs("div",{className:"d-flex justify-content-between",children:[e.jsx("b",{children:"Subtotal:"}),e.jsxs("span",{children:["S/ ",l(t==null?void 0:t.amount)]})]}),e.jsxs("div",{className:"d-flex justify-content-between",children:[e.jsx("b",{children:"Envío:"}),e.jsxs("span",{children:["S/"," ",l(t==null?void 0:t.delivery)]})]}),(t==null?void 0:t.coupon)&&e.jsxs("div",{className:"d-flex justify-content-between",children:[e.jsxs("b",{children:["Cupón aplicado:",e.jsxs("small",{className:"d-block text-muted",style:{fontWeight:"lighter"},children:[(y=t==null?void 0:t.coupon)==null?void 0:y.name," (-",((v=t==null?void 0:t.coupon)==null?void 0:v.amount)*100/100,"%)"]})]}),e.jsxs("span",{children:["S/ -",l(t==null?void 0:t.coupon_discount)]})]}),e.jsx("hr",{className:"my-2"}),e.jsxs("div",{className:"d-flex justify-content-between",children:[e.jsx("b",{children:"Total:"}),e.jsx("span",{children:e.jsxs("strong",{children:["S/ ",l(T)]})})]})]})]})]}),e.jsxs("div",{className:"col-md-4",children:[e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header p-2",children:e.jsx("h5",{className:"card-title mb-0",children:"Estado"})}),e.jsx("div",{className:"card-body p-2",children:e.jsxs("div",{className:"",children:[e.jsx("label",{htmlFor:"statusSelect",className:"form-label",children:"Estado Actual"}),e.jsx("select",{className:"form-select",id:"statusSelect",value:t==null?void 0:t.status_id,onChange:k,disabled:!((g=t==null?void 0:t.status)!=null&&g.reversible),children:x.map((r,s)=>e.jsx("option",{value:r.id,children:r.name},s))})]})})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header p-2",children:e.jsx("h5",{className:"card-title mb-0",children:"Cambios de Estado"})}),e.jsx("div",{className:"card-body p-2 d-flex flex-column gap-1",style:{maxHeight:"300px",overflowY:"auto"},children:h==null?void 0:h.map((r,s)=>{var c,a,i;return e.jsxs("article",{class:"border py-1 px-2 ms-3",style:{position:"relative",borderRadius:"16px 4px 4px 16px",backgroundColor:r.status.color?`${r.status.color}2e`:"#3333332e"},children:[e.jsx("i",{className:"mdi mdi-circle left-2",style:{color:r.status.color||"#333",position:"absolute",left:"-25px",top:"50%",transform:"translateY(-50%)"}}),e.jsx("b",{style:{color:r.status.color||"#333"},children:(c=r==null?void 0:r.status)==null?void 0:c.name}),e.jsxs("small",{className:"d-block text-truncate",children:[(a=r==null?void 0:r.user)==null?void 0:a.name," ",(i=r==null?void 0:r.user)==null?void 0:i.lastname]}),e.jsx("small",{className:"d-block text-muted",children:moment(r.created_at).format("YYYY-MM-DD HH:mm")})]},s)})})]})]})]})})]})};F((x,n)=>{E(x).render(e.jsx(D,{...n,title:"Pedidos",children:e.jsx(G,{...n})}))});
