var F=Object.defineProperty;var D=(i,o,e)=>o in i?F(i,o,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[o]=e;var E=(i,o,e)=>(D(i,typeof o!="symbol"?o+"":o,e),e);import{j as t}from"./RequirementCard-DEdD30eg.js";import{r as c}from"./index-RYns6xqu.js";import{c as S}from"./ReactAppend-vpV7VTGG.js";import{B as T}from"./Base-DmQtm8t4.js";import{C}from"./CreateReactScript-BuKYEKxn.js";import{T as B}from"./Table-CyG7yWBs.js";import{M as z}from"./Modal-1_SBF_XS.js";import{D as N}from"./DxButton-CsjWvhyj.js";import{S as m}from"./sweetalert2.all-DJo0UVK6.js";import{a as v}from"./axios-B4uVmeYG.js";import{B as I}from"./Results-BBVbNL2k.js";import"./index-CXU7o9CY.js";import"./tippy-react.esm-DYFqe69e.js";/* empty css              */import"./Logout-BlWggqgx.js";import"./main-Y8JAyXgE.js";import"./___vite-browser-external_commonjs-proxy-DbMF7jdq.js";import"./index.esm-zkRd-kwu.js";import"./useTranslation-CZbMeh78.js";import"./Filter-CpekYgBC.js";/* empty css               */const P=({col:i,label:o,eRef:e,required:s=!1,children:n,dropdownParent:l,multiple:p=!1,disabled:x=!1,onChange:g=()=>{},templateResult:h,templateSelection:u})=>(e||(e=c.useRef()),c.useEffect(()=>{$(e.current).select2({dropdownParent:l,templateResult:h,templateSelection:u}),$(e.current).on("change",g)},[l]),t.jsxs("div",{className:`form-group ${i} mb-2`,children:[t.jsxs("label",{htmlFor:"",children:[o," ",o&&s&&t.jsx("b",{className:"text-danger",children:"*"})]}),t.jsx("select",{ref:e,required:s,className:"form-control",style:{width:"100%"},disabled:x,multiple:p,children:n})]}));class A extends I{constructor(){super(...arguments);E(this,"path","admin/complaints")}async getAttachments(e){try{const s=await v.get(`/api/${this.path}/${e}/attachments`);return s.data&&Array.isArray(s.data)?s.data.map(n=>({...n,fileIcon:this.getFileIcon(n.mime_type,n.nombre_archivo),fileSizeFormatted:this.formatFileSize(n.tamanio)})):[]}catch(s){throw console.error("Error fetching attachments:",s),this.handleError(s)}}async updateEstado(e,s){try{return(await v.patch(`/api/${this.path}/${e}/update-estado`,{estado:s})).data}catch(n){throw console.error("Error updating estado:",n),this.handleError(n)}}getFileIcon(e,s){const n=s.split(".").pop().toLowerCase();if(e.includes("pdf"))return"fa-file-pdf text-danger";if(e.includes("image"))return"fa-file-image text-primary";if(e.includes("word"))return"fa-file-word text-info";if(e.includes("excel")||e.includes("spreadsheet"))return"fa-file-excel text-success";switch(n){case"doc":case"docx":return"fa-file-word text-info";case"xls":case"xlsx":return"fa-file-excel text-success";case"jpg":case"jpeg":case"png":case"gif":return"fa-file-image text-primary";case"pdf":return"fa-file-pdf text-danger";default:return"fa-file text-secondary"}}formatFileSize(e){if(e===0)return"0 Bytes";const s=1024,n=["Bytes","KB","MB","GB"],l=Math.floor(Math.log(e)/Math.log(s));return parseFloat((e/Math.pow(s,l)).toFixed(2)+" "+n[l])}handleError(e){return e.response?new Error(e.response.data.message||`Error del servidor: ${e.response.status}`):e.request?new Error("No se recibió respuesta del servidor"):new Error("Error al configurar la solicitud")}}const f=new A,M=()=>{const i=c.useRef();c.useState(null);const o=c.useRef();c.useRef();const[e,s]=c.useState(null),[n,l]=c.useState([]);c.useState(null);const p=c.useRef(),x=async r=>{try{s(r),l([]);const a=m.fire({title:"Cargando...",allowOutsideClick:!1,didOpen:()=>{m.showLoading()}}),[d]=await Promise.all([f.getAttachments(r.id),new Promise(j=>setTimeout(j,500))]);Array.isArray(d)?l(d):(console.error("Formato de adjuntos inválido:",d),m.fire({icon:"warning",title:"Advertencia",text:"No se pudieron cargar los archivos adjuntos"})),await a.close(),$(o.current).modal("show")}catch(a){console.error("Error al abrir modal:",a),m.fire({icon:"error",title:"Error",text:"No se pudo cargar la información del reclamo"})}},g=async()=>{try{const r=$(p.current).val();if(!e||!r){m.fire({icon:"error",title:"Error",text:"Datos incompletos para actualizar el estado"});return}const a=await f.updateEstado(e.id,r);if(a.success)s(d=>({...d,estado:r})),$(i.current).dxDataGrid("instance").refresh();else throw new Error(a.message||"Error desconocido")}catch(r){console.error("Error al actualizar estado:",r),m.fire({icon:"error",title:"Error",text:r.message||"No se pudo actualizar el estado"})}},h=r=>{if(!r)return"No especificada";try{return new Date(r).toLocaleDateString("es-PE",{day:"2-digit",month:"2-digit",year:"numeric"})}catch(a){return console.error("Error formateando fecha:",a),"Fecha inválida"}},u=r=>{if(!r)return"No especificada";try{return new Date(r).toLocaleString("es-PE",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"})}catch(a){return console.error("Error formateando fecha/hora:",a),"Fecha/hora inválida"}},b=r=>({dni:"DNI",ce:"Carné Extranjería",pasaporte:"Pasaporte",ruc:"RUC"})[r]||r.toUpperCase(),w=r=>r==="queja"?"Queja":"Reclamo",R=r=>{switch(r){case"pendiente":return"badge bg-warning";case"en_proceso":return"badge bg-info";case"resuelto":return"badge bg-success";case"rechazado":return"badge bg-danger";default:return"badge bg-secondary"}},_=r=>({pendiente:"Pendiente",en_proceso:"En Proceso",resuelto:"Resuelto",rechazado:"Rechazado"})[r]||r,y=async r=>{const{isConfirmed:a}=await m.fire({title:"Eliminar reclamo",text:"¿Estás seguro de eliminar este reclamo?",icon:"warning",showCancelButton:!0,confirmButtonText:"Sí, eliminar",cancelButtonText:"Cancelar"});!a||!await f.delete(r)||$(i.current).dxDataGrid("instance").refresh()};return t.jsxs(t.Fragment,{children:[t.jsx(B,{gridRef:i,title:"Libro de Reclamaciones",rest:f,toolBar:r=>{r.unshift({widget:"dxButton",location:"after",options:{icon:"refresh",hint:"Refrescar tabla",onClick:()=>$(i.current).dxDataGrid("instance").refresh()}})},columns:[{dataField:"id",caption:"ID",visible:!1},{dataField:"numero_reclamo",caption:"N° Reclamo",width:"10%"},{dataField:"nombre_completo",caption:"Consumidor",cellTemplate:(r,{data:a})=>{r.text(`${a.nombre} ${a.apellido}`)},width:"15%"},{dataField:"tipo_documento",caption:"Doc. Identidad",cellTemplate:(r,{data:a})=>{r.text(`${b(a.tipo_documento)}: ${a.numero_documento}`)},width:"12%"},{dataField:"sede",caption:"Sede",width:"12%"},{dataField:"tipo_reclamo",caption:"Tipo",cellTemplate:(r,{data:a})=>{const d=w(a.tipo_reclamo),j=a.tipo_reclamo==="queja"?"badge bg-info":"badge bg-primary";r.append(`<span class="${j}">${d}</span>`)},width:"8%"},{dataField:"fecha_incidente",caption:"Fecha Incidente",cellTemplate:(r,{data:a})=>{r.text(h(a.fecha_incidente))},width:"10%"},{dataField:"estado",caption:"Estado",cellTemplate:(r,{data:a})=>{r.append(`<span class="${R(a.estado)}">${_(a.estado)}</span>`)},width:"10%"},{dataField:"created_at",caption:"Fecha Registro",cellTemplate:(r,{data:a})=>{r.text(u(a.created_at))},width:"10%"},{caption:"Acciones",cellTemplate:(r,{data:a})=>{r.css("text-overflow","unset"),r.append(N({className:"btn btn-xs btn-soft-primary",title:"Ver Detalles",icon:"fa fa-eye",onClick:()=>x(a)})),r.append(N({className:"btn btn-xs btn-soft-danger",title:"Eliminar",icon:"fa fa-trash",onClick:()=>y(a.id)}))},allowFiltering:!1,allowExporting:!1,width:"13%"}]}),t.jsx(z,{modalRef:o,title:`Reclamo #${(e==null?void 0:e.numero_reclamo)||""}`,footer:!0,size:"lg",onSubmit:g,children:t.jsx("div",{className:"row",id:"principal-container",children:e&&t.jsxs("div",{className:"row",children:[t.jsxs("div",{className:"col-md-12 mb-4",children:[t.jsx("h4",{className:"border-bottom pb-2",children:"Información Básica"}),t.jsxs("div",{className:"row",children:[t.jsxs("div",{className:"col-md-6",children:[t.jsxs("p",{children:[t.jsx("strong",{children:"Número de Reclamo:"})," ",e.numero_reclamo]}),t.jsxs("p",{children:[t.jsx("strong",{children:"Fecha Registro:"})," ",u(e.created_at)]})]}),t.jsxs("div",{className:"col-md-6",children:[t.jsxs("p",{children:[t.jsx("strong",{children:"Tipo de Reclamo:"})," ",t.jsx("span",{className:e.tipo_reclamo==="queja"?"badge bg-info":"badge bg-primary",children:w(e.tipo_reclamo)})]}),t.jsxs("p",{children:[t.jsx("strong",{children:"Fecha Incidente:"})," ",h(e.fecha_incidente)]})]}),t.jsxs(P,{col:"col-md-12",label:"Cambiar Estado",eRef:p,dropdownParent:"#principal-container",children:[t.jsx("option",{value:"pendiente",selected:(e==null?void 0:e.estado)==="pendiente",children:"Pendiente"}),t.jsx("option",{value:"en_proceso",selected:(e==null?void 0:e.estado)==="en_proceso",children:"En Proceso"}),t.jsx("option",{value:"resuelto",selected:(e==null?void 0:e.estado)==="resuelto",children:"Resuelto"}),t.jsx("option",{value:"rechazado",selected:(e==null?void 0:e.estado)==="rechazado",children:"Rechazado"})]})]})]}),t.jsxs("div",{className:"col-md-6 mb-4",children:[t.jsx("h4",{className:"border-bottom pb-2",children:"Datos del Consumidor"}),t.jsxs("div",{className:"pl-3",children:[t.jsxs("p",{children:[t.jsx("strong",{children:"Nombre:"})," ",e.nombre," ",e.apellido]}),t.jsxs("p",{children:[t.jsx("strong",{children:"Documento:"})," ",b(e.tipo_documento)," ",e.numero_documento]}),t.jsxs("p",{children:[t.jsx("strong",{children:"Contacto:"})," Tel:"," ",e.telefono," | Email:"," ",e.email]}),t.jsxs("p",{children:[t.jsx("strong",{children:"Dirección:"})," ",e.direccion]})]})]}),t.jsxs("div",{className:"col-md-6 mb-4",children:[t.jsx("h4",{className:"border-bottom pb-2",children:"Detalles del Servicio"}),t.jsxs("div",{className:"pl-3",children:[t.jsxs("p",{children:[t.jsx("strong",{children:"Sede:"})," ",e.sede]}),t.jsxs("p",{children:[t.jsx("strong",{children:"Servicio:"})," ",e.servicio]}),t.jsxs("p",{children:[t.jsx("strong",{children:"Hora Incidente:"})," ",e.hora_incidente||"No especificada"]})]})]}),t.jsxs("div",{className:"col-md-12 mb-4",children:[t.jsx("h4",{className:"border-bottom pb-2",children:"Descripción del Reclamo"}),t.jsx("div",{className:"border p-3 bg-light rounded",children:t.jsx("p",{style:{whiteSpace:"pre-wrap"},children:e.detalle_reclamo})})]}),t.jsxs("div",{className:"col-md-12 mb-4",children:[t.jsx("h4",{className:"border-bottom pb-2",children:"Pedido del Consumidor"}),t.jsx("div",{className:"border p-3 bg-light rounded",children:t.jsx("p",{style:{whiteSpace:"pre-wrap"},children:e.pedido})})]})]})})})]})};C((i,o)=>{S(i).render(t.jsx(T,{...o,title:"Libro de Reclamaciones",children:t.jsx(M,{...o})}))});
