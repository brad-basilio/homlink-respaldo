import{j as s}from"./RequirementCard-DEdD30eg.js";import{r as i}from"./index-RYns6xqu.js";import{c as oe}from"./ReactAppend-vpV7VTGG.js";import{C as ae,e as me,s as ue,R as pe,D as J,l as de,h as o,j as U,u as fe,ay as he,al as ge,w as G}from"./CreateReactScript-C-mUikVe.js";import{r as xe}from"./DxBox-DZgBbgD6.js";import{S as ve}from"./sweetalert2.all-DJo0UVK6.js";import{L as je}from"./Filter-BDLE8FWR.js";import"./index-CXU7o9CY.js";import"./TippyButton-Duhaw_sS.js";import"./DataGrid-Cd7cnf9r.js";import"./___vite-browser-external_commonjs-proxy-DbMF7jdq.js";import"./MenuItem-CBKDeUjr.js";import"./axios-B4uVmeYG.js";import"./Results-CoLI09XT.js";import"./TinyMCEFormGroup-TcwoFScW.js";import"./index-DNUR7M9R.js";import"./Detail-BKcVR7Sx.js";import"./index-SDlHnhXR.js";import"./HomeSeccionBlog-CZ04iwe8.js";import"./CarruselBrands-Chpi1Apc.js";import"./Strengths-8rnVxSkq.js";import"./ModalAppointment-BjEduSb5.js";import"./CallToAction-3RvJBMpr.js";import"./WeCupSection-CkKcxXUy.js";import"./BlurText-Cr9yZ_QA.js";import"./Supplies-DJwkpyzw.js";import"./Banner-CXqQ-nCn.js";import"./HeroSecctionEmpresa-Bs7Po8J9.js";import"./WhatsAppModal-BCTi89gL.js";const P=new he,O=({feature:d,index:l,onUpdate:v,onRemove:b,type:c,canRemove:R,characteristics:_,benefits:N,addCharacteristic:y,addBenefit:C,addStep:S,steps:w,solutions:D,addSolution:I,challenges:q,addChallenge:B})=>{const f=(m,F)=>{v(l,m,F)},E=m=>{v(l,"image",m)};return s.jsx("div",{className:"card mb-3",children:s.jsxs("div",{className:"card-body",children:[s.jsx("div",{className:"row",children:c==="solution"||c==="challenge"?s.jsx("div",{className:"col-md-12",children:s.jsx(o,{label:"Título",value:d.title,onChange:m=>f("title",m.target.value)})}):s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"col-md-9",children:[s.jsx(o,{label:"Título",value:d.title,onChange:m=>f("title",m.target.value)}),s.jsxs("div",{className:"mb-3",children:[s.jsx("label",{className:"form-label",children:"Descripción"}),s.jsx("textarea",{className:"form-control",rows:4,value:d.description,onChange:m=>f("description",m.target.value)})]})]}),s.jsx("div",{className:"col-md-3",children:s.jsx(ge,{current:"success_story",label:"Imagen",currentImage:d.image,onChange:E,aspect:1})})]})}),s.jsxs("div",{className:"d-flex justify-content-between",children:[s.jsx("button",{type:"button",className:"btn btn-sm btn-outline-danger",onClick:()=>b(l),disabled:!R,children:s.jsx("i",{className:"fa fa-trash"})}),c==="characteristic"&&l===_.length-1||c==="benefit"&&l===N.length-1||c==="step"&&l===w.length-1||c==="challenge"&&l===q.length-1||c==="solution"&&l===D.length-1?s.jsxs("button",{type:"button",className:"btn btn-sm btn-outline-primary",onClick:c==="characteristic"?y:c==="benefit"?C:c==="step"?S:c==="challenge"?B:I,children:["+"," ",c==="characteristic"?"Característica":c==="benefit"?"Beneficio":c==="step"?"Paso":c==="challenge"?"Desafío":"Solución"]}):null]})]})})},be=({brands:d})=>{const l=i.useRef(),v=i.useRef(),b=i.useRef(),c=i.useRef(),R=i.useRef(),_=i.useRef(),N=i.useRef(),y=i.useRef(),C=i.useRef(),S=i.useRef(),w=i.useRef(),D=i.useRef(),I=i.useRef(),q=i.useRef(),B=i.useRef(),f=i.useRef(),E=i.useRef(),m=i.useRef(),F=i.useRef(),L=i.useRef(),j=i.useRef(),M=i.useRef(),z=i.useRef(),[K,V]=i.useState(!1),[h,T]=i.useState([{title:""}]),[g,k]=i.useState([{title:""}]),[x,A]=i.useState([{title:"",description:"",image:void 0}]),[Re,Q]=i.useState([{title:"",description:"",image:void 0}]),X=()=>{T([...h,{title:""}])},Y=i.useCallback((e,r,n)=>{T(u=>{const t=[...u];return t[e]={...t[e],[r]:n},t})},[]),Z=e=>{h.length<=1||T(h.filter((r,n)=>n!==e))},ee=()=>{k([...g,{title:""}])},se=i.useCallback((e,r,n)=>{k(u=>{const t=[...u];return t[e]={...t[e],[r]:n},t})},[]),re=e=>{g.length<=1||k(g.filter((r,n)=>n!==e))},ie=()=>{A([...x,{title:"",description:"",image:void 0}])},ne=i.useCallback((e,r,n)=>{A(u=>{const t=[...u];return t[e]={...t[e],[r]:n},t})},[]),ce=e=>{x.length<=1||A(x.filter((r,n)=>n!==e))};i.useCallback((e,r,n)=>{Q(u=>{const t=[...u];return t[e]={...t[e],[r]:n},t})},[]);const W=async e=>{if(e!=null&&e.id?V(!0):V(!1),b.current.value=(e==null?void 0:e.id)??"",c.current.value=(e==null?void 0:e.name)??"",R.current.value=(e==null?void 0:e.summary)??"",_.current.value=(e==null?void 0:e.description)??"",N.current.value=(e==null?void 0:e.title_benefits)??"",y.current.value=(e==null?void 0:e.description_benefits)??"",C.current.value=(e==null?void 0:e.title_challenges)??"",S.current.value=(e==null?void 0:e.description_challenges)??"",w.current.value=(e==null?void 0:e.category_project)??"",D.current.value=(e==null?void 0:e.client_project)??"",I.current.value=(e==null?void 0:e.date_start_project)??"",q.current.value=(e==null?void 0:e.date_end_project)??"",B.current.value=(e==null?void 0:e.duration)??"",f.current.value=(e==null?void 0:e.company_name)??"",m.current.value=(e==null?void 0:e.company_summary)??"",F.current.value=(e==null?void 0:e.company_percentage)??"",L.current.value=(e==null?void 0:e.company_description_percentage)??"",e!=null&&e.services&&e.services.length>0)try{let r=[];if(typeof e.services=="string"?r=e.services.split(",").map(n=>n.trim()).filter(n=>n):Array.isArray(e.services)&&(r=e.services.map(n=>typeof n=="object"?n.id:n)),console.log("Service IDs extraídos:",r),r.length>0){const n=await P.getServicesByIds(r);console.log("Servicios cargados:",n),G(j.current,n,"id","name")}else G(j.current,[],"id","name")}catch(r){console.error("Error al cargar servicios:",r),G(j.current,[],"id","name")}else G(j.current,[],"id","name");M.image.src=`/api/success_story/media/${(e==null?void 0:e.image)??"undefined"}`,E.image.src=`/api/success_story/media/${(e==null?void 0:e.company_logo)??"undefined"}`,z.image.src=`/api/success_story/media/${(e==null?void 0:e.image_challenges)??"undefined"}`,e!=null&&e.benefits&&A(e.benefits.map(r=>({title:r.title,description:r.description,image:r.image}))),e!=null&&e.challenges&&T(e.challenges.map(r=>({title:r.title}))),e!=null&&e.solutions&&k(e.solutions.map(r=>({title:r.title}))),$(v.current).modal("show")},te=async e=>{e.preventDefault();const r=new FormData,n={id:b.current.value||void 0,name:c.current.value,summary:R.current.value,description:_.current.value,title_challenges:C.current.value,description_challenges:S.current.value,title_benefits:N.current.value,description_benefits:y.current.value,category_project:w.current.value,client_project:D.current.value,date_start_project:I.current.value,date_end_project:q.current.value,duration:B.current.value,company_name:f.current.value,company_summary:m.current.value,company_percentage:F.current.value,company_description_percentage:L.current.value,services:$(j.current).val()};for(const a in n)r.append(a,n[a]);const u=M.current.files[0];u&&r.append("image",u);const t=E.current.files[0];t&&r.append("company_logo",t);const H=z.current.files[0];H&&r.append("image_challenges",H),x.forEach((a,p)=>{r.append(`benefits[${p}][title]`,a.title),r.append(`benefits[${p}][description]`,a.description),a.image&&(a.image.file?r.append(`benefits[${p}][image]`,a.image.file):typeof a.image=="string"&&r.append(`benefits[${p}][existing_image]`,a.image))}),h.forEach((a,p)=>{r.append(`challenges[${p}][title]`,a.title)}),g.forEach((a,p)=>{r.append(`solutions[${p}][title]`,a.title)}),await P.save(r)&&($(l.current).dxDataGrid("instance").refresh(),$(v.current).modal("hide"))},le=async e=>{const{isConfirmed:r}=await ve.fire({title:"Eliminar registro",text:"¿Estás seguro de eliminar este caso de éxito?",icon:"warning",showCancelButton:!0,confirmButtonText:"Sí, eliminar",cancelButtonText:"Cancelar"});!r||!await P.delete(e)||$(l.current).dxDataGrid("instance").refresh()};return s.jsxs(s.Fragment,{children:[s.jsx(ue,{gridRef:l,title:"Casos de éxito",rest:P,toolBar:e=>{e.unshift({widget:"dxButton",location:"after",options:{icon:"refresh",hint:"Refrescar tabla",onClick:()=>$(l.current).dxDataGrid("instance").refresh()}}),e.unshift({widget:"dxButton",location:"after",options:{icon:"plus",text:"Agregar",hint:"Agregar nuevo Caso de éxtio",onClick:()=>W()}})},columns:[{dataField:"id",caption:"ID",visible:!1},{dataField:"name",caption:"Título",width:"200px"},{dataField:"description",caption:"Descripción",cellTemplate:(e,{data:r})=>{e.html(xe(s.jsx("div",{className:"text-truncate",style:{maxWidth:"300px"},children:r.description})))}},{dataField:"image",caption:"Imagen",width:"100px",cellTemplate:(e,{data:r})=>{pe(e,s.jsx("img",{src:`/api/success_story/media/${r.image}`,style:{width:"80px",height:"45px",objectFit:"cover",borderRadius:"4px"},onError:n=>n.target.src="/images/default-thumbnail.jpg"}))}},{caption:"Acciones",width:"100px",cellTemplate:(e,{data:r})=>{e.append(J({className:"btn btn-xs btn-soft-primary me-1",title:"Editar",icon:"fa fa-pen",onClick:()=>W(r)})),e.append(J({className:"btn btn-xs btn-soft-danger",title:"Eliminar",icon:"fa fa-trash",onClick:()=>le(r.id)}))}}]}),s.jsxs(de,{modalRef:v,title:K?"Editar Caso de éxito":"Nuevo Caso de éxito",onSubmit:te,size:"xl",children:[s.jsx("input",{ref:b,type:"hidden"}),s.jsxs("div",{className:"row",id:"success-stories-container",children:[s.jsxs("div",{className:"col-md-4",children:[s.jsxs("div",{className:"card mb-4",children:[s.jsx("div",{className:"card-header",children:s.jsx("h6",{className:"mb-0",children:"Información del Proyecto"})}),s.jsxs("div",{className:"card-body",children:[s.jsx(o,{eRef:w,label:"Categoría del proyecto",required:!0}),s.jsx(o,{eRef:D,label:"Cliente del proyecto",required:!0}),s.jsx(o,{eRef:I,label:"Fecha de inicio",type:"date",required:!0}),s.jsx(o,{eRef:q,label:"Fecha de finalización",type:"date",required:!0}),s.jsx(o,{eRef:B,label:"Duración del proyecto",type:"text",required:!0})]})]}),s.jsxs("div",{className:"card",children:[s.jsx("div",{className:"card-header",children:s.jsx("h6",{className:"mb-0",children:"Información de la Empresa"})}),s.jsxs("div",{className:"card-body",children:[s.jsx(U,{eRef:E,label:"Logo de la empresa",aspect:16/9}),s.jsx(o,{eRef:f,label:"Nombre de la empresa",required:!0}),s.jsx(o,{eRef:m,label:"Resumen de la empresa",required:!0}),s.jsx(o,{eRef:F,label:"Porcentaje de éxito",type:"number",required:!0}),s.jsx(o,{eRef:L,label:"Descripción del porcentaje de éxito",required:!0}),s.jsx(fe,{eRef:j,searchAPI:"/api/admin/services/paginate",searchBy:"name",label:"Servicios incluidos",dropdownParent:"#success-stories-container",tags:!0,multiple:!0})]})]})]}),s.jsxs("div",{className:"col-md-8",children:[s.jsxs("div",{className:"card mb-4",children:[s.jsx("div",{className:"card-header",children:s.jsx("h6",{className:"mb-0",children:"Información General"})}),s.jsxs("div",{className:"card-body",children:[s.jsx(U,{eRef:M,label:"Imagen principal",aspect:16/9}),s.jsx(o,{eRef:c,label:"Nombre del Caso de éxito",required:!0}),s.jsx(o,{eRef:R,label:"Resumen del Caso de éxito",required:!0}),s.jsxs("div",{className:"mb-3",children:[s.jsx("label",{className:"form-label",children:"Descripción *"}),s.jsx("textarea",{ref:_,className:"form-control",rows:4,required:!0})]})]})]}),s.jsxs("div",{className:"card mb-4",children:[s.jsx("div",{className:"card-header",children:s.jsx("h6",{className:"mb-0",children:"Beneficios"})}),s.jsxs("div",{className:"card-body",children:[s.jsx(o,{eRef:N,label:"Título de beneficios",required:!0}),s.jsxs("div",{className:"mb-3",children:[s.jsx("label",{className:"form-label",children:"Descripción de beneficios *"}),s.jsx("textarea",{ref:y,className:"form-control",rows:3,required:!0})]}),s.jsx("h6",{className:"mb-3",children:"Lista de Beneficios"}),x.map((e,r)=>s.jsx(O,{feature:e,index:r,onUpdate:ne,onRemove:ce,canRemove:x.length>1,type:"benefit",benefits:x,addBenefit:ie},`benefit-${r}`))]})]}),s.jsxs("div",{className:"card",children:[s.jsx("div",{className:"card-header bg-primary text-white",children:s.jsx("h6",{className:"mb-0 text-white",children:"Desafíos y Soluciones"})}),s.jsx("div",{className:"card-body",children:s.jsxs("div",{className:"row",children:[s.jsxs("div",{className:"col-md-8",children:[s.jsx(o,{eRef:C,label:"Título del desafío",required:!0}),s.jsxs("div",{className:"mb-4",children:[s.jsx("label",{className:"form-label",children:"Descripción del desafío *"}),s.jsx("textarea",{ref:S,className:"form-control",rows:3,required:!0})]}),s.jsxs("div",{className:"row",children:[s.jsxs("div",{className:"col-md-6",children:[s.jsx("h6",{className:"mb-3",children:"Desafíos"}),h.map((e,r)=>s.jsx(O,{feature:e,index:r,onUpdate:Y,onRemove:Z,canRemove:h.length>1,type:"challenge",challenges:h,addChallenge:X},`challenge-${r}`))]}),s.jsxs("div",{className:"col-md-6",children:[s.jsx("h6",{className:"mb-3",children:"Soluciones"}),g.map((e,r)=>s.jsx(O,{feature:e,index:r,onUpdate:se,onRemove:re,canRemove:g.length>1,type:"solution",solutions:g,addSolution:ee},`solution-${r}`))]})]})]}),s.jsx("div",{className:"col-md-4",children:s.jsx(U,{eRef:z,label:"Imagen del desafío",aspect:9/16})})]})})]})]})]})]})]})};ae((d,l)=>{oe(d).render(s.jsx(je,{children:s.jsx(me,{...l,title:"Casos de éxito",children:s.jsx(be,{...l})})}))});
