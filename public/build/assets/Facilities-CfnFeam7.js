var se=Object.defineProperty;var te=(c,a,o)=>a in c?se(c,a,{enumerable:!0,configurable:!0,writable:!0,value:o}):c[a]=o;var S=(c,a,o)=>(te(c,typeof a!="symbol"?a+"":a,o),o);import{j as t}from"./RequirementCard-DEdD30eg.js";import{r}from"./index-RYns6xqu.js";import{B as le}from"./Base-elrL0iSu.js";import{c as ne}from"./ReactAppend-vpV7VTGG.js";import{r as E}from"./DxBox-DZgBbgD6.js";import{S as ie}from"./sweetalert2.all-DJo0UVK6.js";import{M as re}from"./Modal-IE2ysmSM.js";import{T as ae}from"./Table-BTG--uQT.js";import{I as _}from"./InputFormGroup-B7mKwzkx.js";import{D}from"./DxButton-CsjWvhyj.js";import{C as oe}from"./CreateReactScript-BuKYEKxn.js";import{B as ce}from"./Results-BBVbNL2k.js";import"./tippy-react.esm-DYFqe69e.js";import"./index-CXU7o9CY.js";/* empty css              */import"./Logout-BlWggqgx.js";import"./main-Y8JAyXgE.js";import"./___vite-browser-external_commonjs-proxy-DbMF7jdq.js";import"./index.esm-zkRd-kwu.js";import"./axios-B4uVmeYG.js";import"./useTranslation-CZbMeh78.js";import"./Filter-CpekYgBC.js";/* empty css               */class me extends ce{constructor(){super(...arguments);S(this,"path","admin/facilities");S(this,"hasFiles",!0)}}const R=new me,ue=()=>{const[c,a]=r.useState([]),o=r.useRef(),v=r.useRef(),j=r.useRef(),N=r.useRef(),y=r.useRef(),w=r.useRef(),[C,d]=r.useState([]),T=r.useRef(),[m,x]=r.useState([{value:""}]),[u,p]=r.useState([{value:""}]),[h,b]=r.useState([{value:""}]),[f,g]=r.useState([{value:""}]),[k,U]=r.useState(!1),F=e=>{const l=Array.from(e.target.files).map(i=>({file:i,url:URL.createObjectURL(i),isNew:!0}));d(i=>[...i,...l])},A=e=>{d(s=>s.filter((l,i)=>i!==e))},G=()=>{x([...m,{value:""}])},I=(e,s)=>{const l=[...m];l[e].value=s,x(l)},P=e=>{if(m.length<=1)return;const s=m.filter((l,i)=>i!==e);setCharacteristics(s)},O=()=>{p([...u,{value:""}])},J=(e,s)=>{const l=[...u];l[e].value=s,p(l)},L=e=>{if(u.length<=1)return;const s=u.filter((l,i)=>i!==e);p(s)},M=()=>{b([...h,{value:""}])},W=(e,s)=>{const l=[...h];l[e].value=s,b(l)},q=e=>{if(h.length<=1)return;const s=h.filter((l,i)=>i!==e);b(s)},H=()=>{g([...f,{value:""}])},z=(e,s)=>{const l=[...f];l[e].value=s,g(l)},K=e=>{if(f.length<=1)return;const s=f.filter((l,i)=>i!==e);p(s)},B=e=>{if(a(e||null),U(!!(e!=null&&e.id)),j.current.value=(e==null?void 0:e.id)||"",N.current.value=(e==null?void 0:e.title)||"",y.current.value=(e==null?void 0:e.description)||"",e!=null&&e.gallery){console.log(e==null?void 0:e.gallery);const s=e.gallery.map(l=>({url:`/api/facility/media/${l}`,isNew:!1}));d(s)}else d([]);e!=null&&e.ubications&&e.ubications.length>0?x(e.ubications.map(s=>({value:s}))):x([{value:""}]),e!=null&&e.phones&&e.phones.length>0?p(e.phones.map(s=>({value:s}))):p([{value:""}]),e!=null&&e.emails&&e.emails.length>0?b(e.emails.map(s=>({value:s}))):b([{value:""}]),e!=null&&e.business_hours&&e.business_hours.length>0?g(e.business_hours.map(s=>({value:s}))):g([{value:""}]),w.current.value=(e==null?void 0:e.link)??"",$(v.current).modal("show")},Q=async e=>{e.preventDefault();const s=new FormData;s.append("title",N.current.value),s.append("description",y.current.value),s.append("link",w.current.value),k&&s.append("id",j.current.value),C.filter(n=>n.isNew).forEach((n,ee)=>{s.append(`gallery[${ee}]`,n.file)});const l=C.filter(n=>!n.isNew).map(n=>n.url.split("/").pop());s.append("existing_gallery",JSON.stringify(l));const i=m.map(n=>n.value.trim()).filter(n=>n.length>0);s.append("ubications",JSON.stringify(i));const X=u.map(n=>n.value.trim()).filter(n=>n.length>0);s.append("phones",JSON.stringify(X));const Y=h.map(n=>n.value.trim()).filter(n=>n.length>0);s.append("emails",JSON.stringify(Y));const Z=f.map(n=>n.value.trim()).filter(n=>n.length>0);s.append("business_hours",JSON.stringify(Z)),await R.save(s)&&($(o.current).dxDataGrid("instance").refresh(),$(v.current).modal("hide"),d([]),x([{value:""}]),p([{value:""}]),b([{value:""}]),g([{value:""}]))},V=async e=>{const{isConfirmed:s}=await ie.fire({title:"Eliminar Sede",text:"¿Estás seguro de eliminar esta sede?",icon:"warning",showCancelButton:!0,confirmButtonText:"Sí, eliminar",cancelButtonText:"Cancelar"});!s||!await R.delete(e)||$(o.current).dxDataGrid("instance").refresh()};return t.jsxs(t.Fragment,{children:[t.jsx(ae,{gridRef:o,title:"Instalaciones",rest:R,toolBar:e=>{e.unshift({widget:"dxButton",location:"after",options:{icon:"refresh",hint:"Refrescar tabla",onClick:()=>$(o.current).dxDataGrid("instance").refresh()}}),e.unshift({widget:"dxButton",location:"after",options:{icon:"plus",text:"Agregar",hint:"Agregar nueva sede",onClick:()=>B()}})},columns:[{dataField:"id",caption:"ID",visible:!1},{dataField:"title",caption:"Título",width:"200px"},{dataField:"description",caption:"Descripción",cellTemplate:(e,{data:s})=>{e.html(E(t.jsx("div",{className:"text-truncate",style:{maxWidth:"300px"},children:s.description})))}},{dataField:"ubications",caption:"Ubicaciones",cellTemplate:(e,{data:s})=>{s.ubications&&e.html(E(t.jsxs("ul",{className:"m-0 ps-3",style:{listStyle:"none"},children:[s.ubications.slice(0,2).map((l,i)=>t.jsx("li",{className:"text-truncate",style:{maxWidth:"250px"},children:t.jsxs("small",{children:["• ",l]})},i)),s.ubications.length>2&&t.jsx("li",{children:t.jsxs("small",{className:"text-muted",children:["+",s.ubications.length-2," ","más..."]})})]})))}},{dataField:"phones",caption:"Telefonos",cellTemplate:(e,{data:s})=>{s.phones&&e.html(E(t.jsxs("ul",{className:"m-0 ps-3",style:{listStyle:"none"},children:[s.phones.slice(0,2).map((l,i)=>t.jsx("li",{className:"text-truncate",style:{maxWidth:"250px"},children:t.jsxs("small",{children:["• ",l]})},i)),s.phones.length>2&&t.jsx("li",{children:t.jsxs("small",{className:"text-muted",children:["+",s.phones.length-2," ","más..."]})})]})))}},{caption:"Acciones",width:"100px",cellTemplate:(e,{data:s})=>{e.append(D({className:"btn btn-xs btn-soft-primary me-1",title:"Editar",icon:"fa fa-pen",onClick:()=>B(s)})),e.append(D({className:"btn btn-xs btn-soft-danger",title:"Eliminar",icon:"fa fa-trash",onClick:()=>V(s.id)}))}}]}),t.jsxs(re,{modalRef:v,title:k?"Editar Sede":"Nuevo Sede",onSubmit:Q,size:"xl",children:[t.jsx("input",{ref:j,type:"hidden"}),t.jsxs("div",{className:"row",children:[t.jsxs("div",{className:"col-md-6",children:[t.jsx(_,{eRef:N,label:"Sede",required:!0}),t.jsxs("div",{className:"mb-3",children:[t.jsx("label",{className:"form-label",children:"Descripción"}),t.jsx("textarea",{ref:y,className:"form-control",rows:4,required:!0})]}),t.jsxs("div",{className:"mb-3",children:[t.jsx("label",{className:"form-label",children:"Ubicaciones"}),m.map((e,s)=>t.jsxs("div",{className:"input-group mb-2",children:[t.jsx("input",{type:"text",className:"form-control",placeholder:"Ej: Calle Chiclayo 723",value:e.value,onChange:l=>I(s,l.target.value)}),t.jsx("button",{type:"button",className:"btn btn-outline-danger",onClick:()=>P(s),disabled:m.length<=1,children:t.jsx("i",{className:"fas fa-times"})})]},s)),t.jsxs("button",{type:"button",className:"btn btn-sm btn-outline-primary",onClick:G,children:[t.jsx("i",{className:"fas fa-plus me-1"})," Agregar Ubicación"]})]}),t.jsxs("div",{className:"mb-3",children:[t.jsx("label",{className:"form-label",children:"Teléfonos"}),u.map((e,s)=>t.jsxs("div",{className:"input-group mb-2",children:[t.jsx("input",{type:"text",className:"form-control",placeholder:"Ej: 976 953 599",value:e.value,onChange:l=>J(s,l.target.value)}),t.jsx("button",{type:"button",className:"btn btn-outline-danger",onClick:()=>L(s),disabled:u.length<=1,children:t.jsx("i",{className:"fas fa-times"})})]},s)),t.jsxs("button",{type:"button",className:"btn btn-sm btn-outline-primary",onClick:O,children:[t.jsx("i",{className:"fas fa-plus me-1"})," Agregar Teléfono"]})]})]}),t.jsxs("div",{className:"col-md-6",children:[t.jsxs("div",{className:"mb-3",children:[t.jsx("label",{className:"form-label",children:"Correos"}),h.map((e,s)=>t.jsxs("div",{className:"input-group mb-2",children:[t.jsx("input",{type:"text",className:"form-control",placeholder:"Ej: info-miraflores@nopain.com.pe",value:e.value,onChange:l=>W(s,l.target.value)}),t.jsx("button",{type:"button",className:"btn btn-outline-danger",onClick:()=>q(s),disabled:h.length<=1,children:t.jsx("i",{className:"fas fa-times"})})]},s)),t.jsxs("button",{type:"button",className:"btn btn-sm btn-outline-primary",onClick:M,children:[t.jsx("i",{className:"fas fa-plus me-1"})," Agregar Correo"]})]}),t.jsxs("div",{className:"mb-3",children:[t.jsx("label",{className:"form-label",children:"Horarios de Atención"}),f.map((e,s)=>t.jsxs("div",{className:"input-group mb-2",children:[t.jsx("input",{type:"text",className:"form-control",placeholder:"Ej: Lunes a viernes: 8:00 am a 8:00 pm",value:e.value,onChange:l=>z(s,l.target.value)}),t.jsx("button",{type:"button",className:"btn btn-outline-danger",onClick:()=>K(s),disabled:f.length<=1,children:t.jsx("i",{className:"fas fa-times"})})]},s)),t.jsxs("button",{type:"button",className:"btn btn-sm btn-outline-primary",onClick:H,children:[t.jsx("i",{className:"fas fa-plus me-1"})," Agregar Horas de negocio"]})]}),t.jsx(_,{type:"url",eRef:w,label:"Link"}),t.jsxs("div",{className:"mb-3",children:[t.jsx("label",{className:"form-label",children:"Galería de imágenes"}),t.jsx("input",{type:"file",ref:T,multiple:!0,accept:"image/*",onChange:F,className:"form-control"}),t.jsx("div",{className:"d-flex flex-wrap gap-2 mt-2",children:C.map((e,s)=>t.jsxs("div",{className:"position-relative",style:{width:"100px",height:"100px"},children:[t.jsx("img",{src:e.url,alt:"Preview",className:"img-thumbnail h-100 w-100 object-fit-cover"}),t.jsx("button",{type:"button",className:"btn btn-danger btn-xs position-absolute top-0 end-0",onClick:()=>A(s),children:"×"})]},s))})]})]})]})]})]})};oe((c,a)=>{ne(c).render(t.jsx(le,{...a,title:"Sedes",children:t.jsx(ue,{...a})}))});
