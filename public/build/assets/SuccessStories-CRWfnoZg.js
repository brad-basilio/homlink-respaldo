var ae=Object.defineProperty;var me=(m,n,o)=>n in m?ae(m,n,{enumerable:!0,configurable:!0,writable:!0,value:o}):m[n]=o;var P=(m,n,o)=>(me(m,typeof n!="symbol"?n+"":n,o),o);import{j as s}from"./RequirementCard-DEdD30eg.js";import{r as i}from"./index-RYns6xqu.js";import{c as ue}from"./ReactAppend-vpV7VTGG.js";import{B as pe}from"./Base-elrL0iSu.js";import{r as fe}from"./DxBox-DZgBbgD6.js";import{S as de}from"./sweetalert2.all-DJo0UVK6.js";import{M as he}from"./Modal-IE2ysmSM.js";import{T as ge}from"./Table-BTG--uQT.js";import{I as X}from"./ImageFormGroup-Csvj9Cte.js";import{I as a}from"./InputFormGroup-B7mKwzkx.js";import{S as xe,a as G}from"./SetSelectValue-DXrntqGI.js";import{D as V}from"./DxButton-CsjWvhyj.js";import{C as ve}from"./CreateReactScript-BuKYEKxn.js";import{R as je}from"./ReactAppend-DPXaoPQG.js";import{L as be}from"./Filter-CpekYgBC.js";import{D as Re}from"./DragDropImage-BoC6KBUm.js";import{B as _e}from"./Results-BBVbNL2k.js";import"./index-CXU7o9CY.js";import"./tippy-react.esm-DYFqe69e.js";/* empty css              */import"./Logout-BlWggqgx.js";import"./main-Y8JAyXgE.js";import"./___vite-browser-external_commonjs-proxy-DbMF7jdq.js";import"./index.esm-zkRd-kwu.js";import"./axios-B4uVmeYG.js";import"./useTranslation-CZbMeh78.js";/* empty css               */import"./index-DNUR7M9R.js";class Ne extends _e{constructor(){super(...arguments);P(this,"path","admin/success_stories");P(this,"hasFiles",!0);P(this,"getServicesByIds",async o=>{var g;try{if(!o||o.length===0)return[];const c=o.join(","),f=await fetch("/api/admin/services/paginate",{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json","X-Xsrf-Token":decodeURIComponent(((g=document.cookie.split("; ").find(h=>h.startsWith("XSRF-TOKEN=")))==null?void 0:g.split("=")[1])||"")},body:JSON.stringify({take:100,skip:0,requireTotalCount:!1,isLoadingAll:!0})});if(!f.ok)throw new Error(`Error ${f.status}: ${f.statusText}`);return((await f.json()).data||[]).filter(h=>o.includes(h.id))}catch(c){return console.error("Error al obtener servicios por IDs:",c),[]}})}}const L=new Ne,z=({feature:m,index:n,onUpdate:o,onRemove:g,type:c,canRemove:f,characteristics:_,benefits:N,addCharacteristic:y,addBenefit:h,addStep:C,steps:w,solutions:D,addSolution:B,challenges:I,addChallenge:T})=>{const v=(p,q)=>{o(n,p,q)},E=p=>{o(n,"image",p)};return s.jsx("div",{className:"card mb-3",children:s.jsxs("div",{className:"card-body",children:[s.jsx("div",{className:"row",children:c==="solution"||c==="challenge"?s.jsx("div",{className:"col-md-12",children:s.jsx(a,{label:"Título",value:m.title,onChange:p=>v("title",p.target.value)})}):s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"col-md-9",children:[s.jsx(a,{label:"Título",value:m.title,onChange:p=>v("title",p.target.value)}),s.jsxs("div",{className:"mb-3",children:[s.jsx("label",{className:"form-label",children:"Descripción"}),s.jsx("textarea",{className:"form-control",rows:4,value:m.description,onChange:p=>v("description",p.target.value)})]})]}),s.jsx("div",{className:"col-md-3",children:s.jsx(Re,{current:"success_story",label:"Imagen",currentImage:m.image,onChange:E,aspect:1})})]})}),s.jsxs("div",{className:"d-flex justify-content-between",children:[s.jsx("button",{type:"button",className:"btn btn-sm btn-outline-danger",onClick:()=>g(n),disabled:!f,children:s.jsx("i",{className:"fa fa-trash"})}),c==="characteristic"&&n===_.length-1||c==="benefit"&&n===N.length-1||c==="step"&&n===w.length-1||c==="challenge"&&n===I.length-1||c==="solution"&&n===D.length-1?s.jsxs("button",{type:"button",className:"btn btn-sm btn-outline-primary",onClick:c==="characteristic"?y:c==="benefit"?h:c==="step"?C:c==="challenge"?T:B,children:["+"," ",c==="characteristic"?"Característica":c==="benefit"?"Beneficio":c==="step"?"Paso":c==="challenge"?"Desafío":"Solución"]}):null]})]})})},ye=({brands:m})=>{const n=i.useRef(),o=i.useRef(),g=i.useRef(),c=i.useRef(),f=i.useRef(),_=i.useRef(),N=i.useRef(),y=i.useRef(),h=i.useRef(),C=i.useRef(),w=i.useRef(),D=i.useRef(),B=i.useRef(),I=i.useRef(),T=i.useRef(),v=i.useRef(),E=i.useRef(),p=i.useRef(),q=i.useRef(),M=i.useRef(),S=i.useRef(),O=i.useRef(),U=i.useRef(),[H,W]=i.useState(!1),[j,k]=i.useState([{title:""}]),[b,F]=i.useState([{title:""}]),[R,A]=i.useState([{title:"",description:"",image:void 0}]),[Se,Q]=i.useState([{title:"",description:"",image:void 0}]),Y=()=>{k([...j,{title:""}])},Z=i.useCallback((e,r,t)=>{k(d=>{const l=[...d];return l[e]={...l[e],[r]:t},l})},[]),ee=e=>{j.length<=1||k(j.filter((r,t)=>t!==e))},se=()=>{F([...b,{title:""}])},re=i.useCallback((e,r,t)=>{F(d=>{const l=[...d];return l[e]={...l[e],[r]:t},l})},[]),ie=e=>{b.length<=1||F(b.filter((r,t)=>t!==e))},te=()=>{A([...R,{title:"",description:"",image:void 0}])},ne=i.useCallback((e,r,t)=>{A(d=>{const l=[...d];return l[e]={...l[e],[r]:t},l})},[]),ce=e=>{R.length<=1||A(R.filter((r,t)=>t!==e))};i.useCallback((e,r,t)=>{Q(d=>{const l=[...d];return l[e]={...l[e],[r]:t},l})},[]);const J=async e=>{if(e!=null&&e.id?W(!0):W(!1),g.current.value=(e==null?void 0:e.id)??"",c.current.value=(e==null?void 0:e.name)??"",f.current.value=(e==null?void 0:e.summary)??"",_.current.value=(e==null?void 0:e.description)??"",N.current.value=(e==null?void 0:e.title_benefits)??"",y.current.value=(e==null?void 0:e.description_benefits)??"",h.current.value=(e==null?void 0:e.title_challenges)??"",C.current.value=(e==null?void 0:e.description_challenges)??"",w.current.value=(e==null?void 0:e.category_project)??"",D.current.value=(e==null?void 0:e.client_project)??"",B.current.value=(e==null?void 0:e.date_start_project)??"",I.current.value=(e==null?void 0:e.date_end_project)??"",T.current.value=(e==null?void 0:e.duration)??"",v.current.value=(e==null?void 0:e.company_name)??"",p.current.value=(e==null?void 0:e.company_summary)??"",q.current.value=(e==null?void 0:e.company_percentage)??"",M.current.value=(e==null?void 0:e.company_description_percentage)??"",e!=null&&e.services&&e.services.length>0)try{let r=[];if(typeof e.services=="string"?r=e.services.split(",").map(t=>t.trim()).filter(t=>t):Array.isArray(e.services)&&(r=e.services.map(t=>typeof t=="object"?t.id:t)),console.log("Service IDs extraídos:",r),r.length>0){const t=await L.getServicesByIds(r);console.log("Servicios cargados:",t),G(S.current,t,"id","name")}else G(S.current,[],"id","name")}catch(r){console.error("Error al cargar servicios:",r),G(S.current,[],"id","name")}else G(S.current,[],"id","name");O.image.src=`/api/success_story/media/${(e==null?void 0:e.image)??"undefined"}`,E.image.src=`/api/success_story/media/${(e==null?void 0:e.company_logo)??"undefined"}`,U.image.src=`/api/success_story/media/${(e==null?void 0:e.image_challenges)??"undefined"}`,e!=null&&e.benefits&&A(e.benefits.map(r=>({title:r.title,description:r.description,image:r.image}))),e!=null&&e.challenges&&k(e.challenges.map(r=>({title:r.title}))),e!=null&&e.solutions&&F(e.solutions.map(r=>({title:r.title}))),$(o.current).modal("show")},le=async e=>{e.preventDefault();const r=new FormData,t={id:g.current.value||void 0,name:c.current.value,summary:f.current.value,description:_.current.value,title_challenges:h.current.value,description_challenges:C.current.value,title_benefits:N.current.value,description_benefits:y.current.value,category_project:w.current.value,client_project:D.current.value,date_start_project:B.current.value,date_end_project:I.current.value,duration:T.current.value,company_name:v.current.value,company_summary:p.current.value,company_percentage:q.current.value,company_description_percentage:M.current.value,services:$(S.current).val()};for(const u in t)r.append(u,t[u]);const d=O.current.files[0];d&&r.append("image",d);const l=E.current.files[0];l&&r.append("company_logo",l);const K=U.current.files[0];K&&r.append("image_challenges",K),R.forEach((u,x)=>{r.append(`benefits[${x}][title]`,u.title),r.append(`benefits[${x}][description]`,u.description),u.image&&(u.image.file?r.append(`benefits[${x}][image]`,u.image.file):typeof u.image=="string"&&r.append(`benefits[${x}][existing_image]`,u.image))}),j.forEach((u,x)=>{r.append(`challenges[${x}][title]`,u.title)}),b.forEach((u,x)=>{r.append(`solutions[${x}][title]`,u.title)}),await L.save(r)&&($(n.current).dxDataGrid("instance").refresh(),$(o.current).modal("hide"))},oe=async e=>{const{isConfirmed:r}=await de.fire({title:"Eliminar registro",text:"¿Estás seguro de eliminar este caso de éxito?",icon:"warning",showCancelButton:!0,confirmButtonText:"Sí, eliminar",cancelButtonText:"Cancelar"});!r||!await L.delete(e)||$(n.current).dxDataGrid("instance").refresh()};return s.jsxs(s.Fragment,{children:[s.jsx(ge,{gridRef:n,title:"Casos de éxito",rest:L,toolBar:e=>{e.unshift({widget:"dxButton",location:"after",options:{icon:"refresh",hint:"Refrescar tabla",onClick:()=>$(n.current).dxDataGrid("instance").refresh()}}),e.unshift({widget:"dxButton",location:"after",options:{icon:"plus",text:"Agregar",hint:"Agregar nuevo Caso de éxtio",onClick:()=>J()}})},columns:[{dataField:"id",caption:"ID",visible:!1},{dataField:"name",caption:"Título",width:"200px"},{dataField:"description",caption:"Descripción",cellTemplate:(e,{data:r})=>{e.html(fe(s.jsx("div",{className:"text-truncate",style:{maxWidth:"300px"},children:r.description})))}},{dataField:"image",caption:"Imagen",width:"100px",cellTemplate:(e,{data:r})=>{je(e,s.jsx("img",{src:`/api/success_story/media/${r.image}`,style:{width:"80px",height:"45px",objectFit:"cover",borderRadius:"4px"},onError:t=>t.target.src="/images/default-thumbnail.jpg"}))}},{caption:"Acciones",width:"100px",cellTemplate:(e,{data:r})=>{e.append(V({className:"btn btn-xs btn-soft-primary me-1",title:"Editar",icon:"fa fa-pen",onClick:()=>J(r)})),e.append(V({className:"btn btn-xs btn-soft-danger",title:"Eliminar",icon:"fa fa-trash",onClick:()=>oe(r.id)}))}}]}),s.jsxs(he,{modalRef:o,title:H?"Editar Caso de éxito":"Nuevo Caso de éxito",onSubmit:le,size:"xl",children:[s.jsx("input",{ref:g,type:"hidden"}),s.jsxs("div",{className:"row",id:"success-stories-container",children:[s.jsxs("div",{className:"col-md-4",children:[s.jsxs("div",{className:"card mb-4",children:[s.jsx("div",{className:"card-header",children:s.jsx("h6",{className:"mb-0",children:"Información del Proyecto"})}),s.jsxs("div",{className:"card-body",children:[s.jsx(a,{eRef:w,label:"Categoría del proyecto",required:!0}),s.jsx(a,{eRef:D,label:"Cliente del proyecto",required:!0}),s.jsx(a,{eRef:B,label:"Fecha de inicio",type:"date",required:!0}),s.jsx(a,{eRef:I,label:"Fecha de finalización",type:"date",required:!0}),s.jsx(a,{eRef:T,label:"Duración del proyecto",type:"text",required:!0})]})]}),s.jsxs("div",{className:"card",children:[s.jsx("div",{className:"card-header",children:s.jsx("h6",{className:"mb-0",children:"Información de la Empresa"})}),s.jsxs("div",{className:"card-body",children:[s.jsx(X,{eRef:E,label:"Logo de la empresa",aspect:16/9}),s.jsx(a,{eRef:v,label:"Nombre de la empresa",required:!0}),s.jsx(a,{eRef:p,label:"Resumen de la empresa",required:!0}),s.jsx(a,{eRef:q,label:"Porcentaje de éxito",type:"number",required:!0}),s.jsx(a,{eRef:M,label:"Descripción del porcentaje de éxito",required:!0}),s.jsx(xe,{eRef:S,searchAPI:"/api/admin/services/paginate",searchBy:"name",label:"Servicios incluidos",dropdownParent:"#success-stories-container",tags:!0,multiple:!0})]})]})]}),s.jsxs("div",{className:"col-md-8",children:[s.jsxs("div",{className:"card mb-4",children:[s.jsx("div",{className:"card-header",children:s.jsx("h6",{className:"mb-0",children:"Información General"})}),s.jsxs("div",{className:"card-body",children:[s.jsx(X,{eRef:O,label:"Imagen principal",aspect:16/9}),s.jsx(a,{eRef:c,label:"Nombre del Caso de éxito",required:!0}),s.jsx(a,{eRef:f,label:"Resumen del Caso de éxito",required:!0}),s.jsxs("div",{className:"mb-3",children:[s.jsx("label",{className:"form-label",children:"Descripción *"}),s.jsx("textarea",{ref:_,className:"form-control",rows:4,required:!0})]})]})]}),s.jsxs("div",{className:"card mb-4",children:[s.jsx("div",{className:"card-header",children:s.jsx("h6",{className:"mb-0",children:"Beneficios"})}),s.jsxs("div",{className:"card-body",children:[s.jsx(a,{eRef:N,label:"Título de beneficios",required:!0}),s.jsxs("div",{className:"mb-3",children:[s.jsx("label",{className:"form-label",children:"Descripción de beneficios *"}),s.jsx("textarea",{ref:y,className:"form-control",rows:3,required:!0})]}),s.jsx("h6",{className:"mb-3",children:"Lista de Beneficios"}),R.map((e,r)=>s.jsx(z,{feature:e,index:r,onUpdate:ne,onRemove:ce,canRemove:R.length>1,type:"benefit",benefits:R,addBenefit:te},`benefit-${r}`))]})]}),s.jsxs("div",{className:"card",children:[s.jsx("div",{className:"card-header bg-primary text-white",children:s.jsx("h6",{className:"mb-0 text-white",children:"Desafíos y Soluciones"})}),s.jsx("div",{className:"card-body",children:s.jsxs("div",{className:"row",children:[s.jsxs("div",{className:"col-md-8",children:[s.jsx(a,{eRef:h,label:"Título del desafío",required:!0}),s.jsxs("div",{className:"mb-4",children:[s.jsx("label",{className:"form-label",children:"Descripción del desafío *"}),s.jsx("textarea",{ref:C,className:"form-control",rows:3,required:!0})]}),s.jsxs("div",{className:"row",children:[s.jsxs("div",{className:"col-md-6",children:[s.jsx("h6",{className:"mb-3",children:"Desafíos"}),j.map((e,r)=>s.jsx(z,{feature:e,index:r,onUpdate:Z,onRemove:ee,canRemove:j.length>1,type:"challenge",challenges:j,addChallenge:Y},`challenge-${r}`))]}),s.jsxs("div",{className:"col-md-6",children:[s.jsx("h6",{className:"mb-3",children:"Soluciones"}),b.map((e,r)=>s.jsx(z,{feature:e,index:r,onUpdate:re,onRemove:ie,canRemove:b.length>1,type:"solution",solutions:b,addSolution:se},`solution-${r}`))]})]})]}),s.jsx("div",{className:"col-md-4",children:s.jsx(X,{eRef:U,label:"Imagen del desafío",aspect:9/16})})]})})]})]})]})]})]})};ve((m,n)=>{ue(m).render(s.jsx(be,{children:s.jsx(pe,{...n,title:"Casos de éxito",children:s.jsx(ye,{...n})})}))});
