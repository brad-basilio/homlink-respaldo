var ee=Object.defineProperty;var re=(m,t,o)=>t in m?ee(m,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):m[t]=o;var H=(m,t,o)=>(re(m,typeof t!="symbol"?t+"":t,o),o);import{j as e}from"./RequirementCard-DEdD30eg.js";import{r as c}from"./index-RYns6xqu.js";import{c as se}from"./ReactAppend-vpV7VTGG.js";import{B as te}from"./Base-elrL0iSu.js";import{C as ne}from"./CreateReactScript-BuKYEKxn.js";import{M as ie}from"./Modal-1_SBF_XS.js";import{I as K}from"./InputFormGroup-B7mKwzkx.js";import{S as oe}from"./SwitchFormGroup-SB6Qzl6-.js";import{I as ce}from"./ImageFormGroup-Csvj9Cte.js";import"./sweetalert2.all-DJo0UVK6.js";import{T as ae}from"./TextareaFormGroup-B4XWcpu0.js";import{m as N}from"./main-Y8JAyXgE.js";import{B as le}from"./Results-BBVbNL2k.js";import"./index-CXU7o9CY.js";import"./tippy-react.esm-DYFqe69e.js";/* empty css              */import"./Logout-BlWggqgx.js";import"./index.esm-zkRd-kwu.js";import"./axios-B4uVmeYG.js";import"./___vite-browser-external_commonjs-proxy-DbMF7jdq.js";import"./useTranslation-CZbMeh78.js";import"./Filter-CpekYgBC.js";/* empty css               */const ue=({id:m,col:t="col-12",label:o,eRef:a,required:f=!1,onChange:M=()=>{},onError:V="/api/cover/thumbnail/null"})=>{const[L,R]=c.useState(""),j=c.useRef(),x=c.useRef();c.useEffect(()=>{a&&(a.current={getFile:()=>j.current.files[0],setVideoSrc:h=>{R(h),x.current.src=h}})},[a]);const B=h=>{const A=h.target.files[0];if(A){const J=URL.createObjectURL(A);R(J),M(h)}};return e.jsxs("div",{className:`form-group ${t} mb-1`,children:[e.jsxs("label",{htmlFor:m,className:"mb-1",children:[o," ",f&&e.jsx("b",{className:"text-danger",children:"*"})]}),e.jsx("video",{ref:x,controls:!0,src:L,style:{width:"100%",borderRadius:"4px",background:"#000",display:L?"block":"none"},onError:h=>{h.target.src=V}}),e.jsx("input",{id:m,type:"file",ref:j,accept:"video/*",onChange:B,className:"form-control mt-2"})]})};class de extends le{constructor(){super(...arguments);H(this,"path","admin/landing_home");H(this,"hasFiles",!0);H(this,"translate",async o=>{try{const{status:a,result:f}=await N.Fetch(`/api/${this.path}/translate`,{method:"POST",body:JSON.stringify(o)});if(!a)throw new Error((f==null?void 0:f.message)||"Error al guardar traducción");return f}catch(a){return N.Notify.error(a.message),null}});H(this,"getByLang",async o=>{try{const{status:a,result:f}=await N.Fetch(`/api/${this.path}/by_lang/${o}`);if(!a)throw new Error((f==null?void 0:f.message)||"Error al obtener traducciones");return f}catch(a){return N.Notify.error(a.message),null}})}}const z=new de,me=m=>{if(!m)return"home";const t=m.split("_");return t.length<2?"home":t[1]},U=({data:m,field:t,currentLangId:o,defaultLangId:a,onSave:f})=>{const[M,V]=c.useState(m[t]||""),[L,R]=c.useState(!1),j=o===a,x=!j,B=()=>{f(t,M),R(!1)};return e.jsx("div",{className:`d-flex gap-2 align-items-center ${x?"translation-field":""}`,children:j?e.jsx("span",{children:m[t]}):e.jsxs(e.Fragment,{children:[e.jsx("input",{className:"form-control flex-grow-1",value:M,onChange:h=>{V(h.target.value),R(!0)},disabled:!x}),L&&x&&e.jsx("button",{className:"btn btn-xs btn-soft-primary",onClick:B,children:e.jsx("i",{className:"fa fa-save"})})]})})},fe=({items:m,current_lang_id:t,default_lang_id:o})=>{const a=c.useRef(),[f,M]=c.useState("home"),[V,L]=c.useState(!1),[R,j]=c.useState(!1);c.useState("");const[x,B]=c.useState(m),[h,A]=c.useState({}),[J,Q]=c.useState(!1),S=c.useRef(null),I=c.useRef(null),k=c.useRef(null),E=c.useRef(null),l=c.useRef(null),C=c.useRef(null),w=c.useRef(null),F=c.useRef(null),[Z,W]=c.useState(null),O={home:"Inicio",catalogo:"Catálogo",aboutus:"Nosotros",contact:"Contacto",blog:"Blog"};c.useEffect(()=>{(async()=>{if(t!==o){Q(!0);try{const n=await z.getByLang(t),d={};n.forEach(s=>{s.original_id&&(d[s.original_id]=s)}),A(d)}catch(n){N.Notify.error("Error al cargar traducciones"),console.error("Error loading translations:",n)}finally{Q(!1)}}else A({})})()},[t,o]);const D=x.reduce((r,n)=>{const d=me(n.correlative);r[d]||(r[d]=[]);const s=h[n.original_id||n.id]||{},y={...n,title:t!==o&&s.title||n.title,subtitle:t!==o&&s.subtitle||n.subtitle,description:t!==o&&s.description||n.description,link:t!==o&&s.link||n.link,is_translated:!!s.id};return r[d].push(y),r},{});c.useEffect(()=>{var r;console.log("Items agrupados:",D),console.log("Items en home:",(r=D.home)==null?void 0:r.length),console.log("Total items:",x.length)},[D,x]),c.useEffect(()=>{console.log("Items cambiaron, total:",x.length)},[x]);const X=r=>{r!=null&&r.id?L(!0):(L(!1),setTimeout(()=>{S.current&&(S.current.value=""),I.current&&(I.current.value=""),k.current&&(k.current.value=""),E.current&&(E.current.value=""),w.current&&(w.current.value=""),F.current&&(F.current.checked=!1),l.current&&(l.current.value="",setTimeout(()=>{l.current&&l.current.image&&(l.current.image.src="")},50)),j(!1)},50));const n=(r==null?void 0:r.is_video)==="1"||(r==null?void 0:r.is_video)===1;j(n),setTimeout(()=>{r!=null&&r.id&&(S.current&&(S.current.value=(r==null?void 0:r.id)??""),I.current&&(I.current.value=(r==null?void 0:r.title)??""),k.current&&(k.current.value=(r==null?void 0:r.subtitle)??""),E.current&&(E.current.value=(r==null?void 0:r.description)??""),w.current&&(w.current.value=(r==null?void 0:r.link)??""),F.current&&(F.current.checked=n),n&&C.current&&(r!=null&&r.video)?C.current.setVideoSrc(`/api/landing_home/video/${r.video}`):!n&&l.current&&(r!=null&&r.image)&&setTimeout(()=>{if(l.current){const s=`/api/landing_home/media/${r.image}`;console.log("Cargando imagen en modal:",s),console.log("ImageRef.current:",l.current),console.log("ImageRef.current.image:",l.current.image),l.current.src=s,W(s)}else console.log("ImageRef o image no disponible:",{imageRef:!!l.current,image:!!(l.current&&l.current.image)})},100))},300),new bootstrap.Modal(a.current).show()},_=async r=>{var n,d,s,y,p,b,u,q;r.preventDefault();try{const g=new FormData;if((n=S.current)!=null&&n.value&&g.append("id",S.current.value),(d=I.current)!=null&&d.value&&g.append("title",I.current.value),(s=k.current)!=null&&s.value&&g.append("subtitle",k.current.value),(y=E.current)!=null&&y.value&&g.append("description",E.current.value),(p=w.current)!=null&&p.value&&g.append("link",w.current.value),g.append("is_video",(b=F.current)!=null&&b.checked?"1":"0"),g.append("lang_id",o),R&&C.current){const i=C.current.getFile();i&&g.append("video",i)}else!R&&((q=(u=l.current)==null?void 0:u.files)!=null&&q[0])&&g.append("image",l.current.files[0]);const T=await z.save(g);if(!T){N.Notify.error("Error al guardar la sección");return}console.log("Resultado del save:",T),B(V?i=>i.map(v=>v.id===T.data.id?T.data:v):i=>[T.data,...i]);try{const i=await z.paginate({page:1,per_page:1e3,search:"",orderBy:"created_at",order:"desc"});if(console.log("Respuesta completa de paginate:",i),i){let v=null;i.data&&Array.isArray(i.data)?v=i.data:i.result&&i.result.data&&Array.isArray(i.result.data)?v=i.result.data:Array.isArray(i)&&(v=i),console.log("Items extraídos:",v),v&&v.length>=0&&(B(v),console.log("Items actualizados desde servidor:",v.length))}}catch(i){console.warn("Error al recargar desde servidor, usando actualización local",i)}try{const i=a.current.querySelector(".btn-close");if(i)i.click();else{const v=a.current.querySelector('[data-bs-dismiss="modal"]');if(v)v.click();else{const Y=bootstrap.Modal.getInstance(a.current);Y?Y.hide():new bootstrap.Modal(a.current).hide()}}}catch(i){console.error("Error al cerrar modal:",i),$(a.current).modal("hide")}setTimeout(()=>{S.current&&(S.current.value=""),I.current&&(I.current.value=""),k.current&&(k.current.value=""),E.current&&(E.current.value=""),w.current&&(w.current.value=""),F.current&&(F.current.checked=!1),l.current&&(l.current.value="",setTimeout(()=>{l.current&&l.current.image&&(l.current.image.src="")},50)),C.current&&typeof C.current.clearVideo=="function"&&C.current.clearVideo(),j(!1),L(!1),W(null)},200),N.Notify.success("Sección guardada correctamente")}catch(g){console.error("Error al enviar el formulario:",g),N.Notify.error("Hubo un error al enviar el formulario")}},G=async(r,n,d)=>{var s,y,p,b;try{const u=x.find(T=>T.id===r);if(!u)return;const q={original_id:u.original_id||u.id,[n]:d,lang_id:t,title:n==="title"?d:((s=h[u.id])==null?void 0:s.title)||u.title,subtitle:n==="subtitle"?d:((y=h[u.id])==null?void 0:y.subtitle)||u.subtitle,description:n==="description"?d:((p=h[u.id])==null?void 0:p.description)||u.description,link:n==="link"?d:((b=h[u.id])==null?void 0:b.link)||u.link},g=await z.translate(q);if(!g)return;A(T=>{const i={...T};return i[u.id]||(i[u.id]={...u,id:g.id,original_id:u.id,lang_id:t}),i[u.id][n]=d,i}),N.Notify.success("Traducción guardada correctamente")}catch(u){N.Notify.error("Error al guardar traducción"),console.error(u)}},P=t!==o;return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:`card ${P?"translation-mode":""}`,children:[e.jsxs("div",{className:"card-header d-flex justify-content-between align-items-center",children:[e.jsx("ul",{className:"nav nav-tabs card-header-tabs",children:Object.keys(O).map(r=>e.jsx("li",{className:"nav-item",children:e.jsx("button",{className:`nav-link ${f===r?"active":""}`,onClick:()=>M(r),children:O[r]})},r))}),e.jsxs("div",{className:"d-flex align-items-center gap-2",children:[P&&e.jsxs("span",{className:"badge bg-success me-2",style:{padding:"6px"},children:[e.jsx("i",{className:"fa fa-language me-1"})," Modo Traducción"]}),e.jsxs("button",{className:"btn btn-primary btn-sm",onClick:()=>X({correlative:`page_${f}_new`,lang_id:o}),children:[e.jsx("i",{className:"fa fa-plus me-1"})," Nueva Sección"]})]})]}),e.jsx("div",{className:"card-body",children:J?e.jsxs("div",{className:"text-center py-5",children:[e.jsx("div",{className:"spinner-border text-primary",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Cargando..."})}),e.jsx("p",{className:"mt-2",children:"Cargando traducciones..."})]}):Object.keys(O).map(r=>{var n,d;return e.jsxs("div",{style:{display:f===r?"block":"none"},children:[e.jsxs("h4",{className:"mb-4",children:["Secciones de ",O[r]]}),e.jsxs("p",{className:"text-muted mb-3",children:["Mostrando ",((n=D[r])==null?void 0:n.length)||0," ","secciones"]}),((d=D[r])==null?void 0:d.length)===0?e.jsx("div",{className:"alert alert-info",children:"No hay secciones configuradas para esta página"}):e.jsx("div",{className:"row",children:(D[r]||[]).map(s=>{var y;return e.jsx("div",{className:"col-md-6 mb-4",children:e.jsxs("div",{className:"card h-100",children:[e.jsx("div",{className:"card-header d-flex justify-content-between align-items-center",children:e.jsxs("h5",{className:"mb-0",children:[((y=s.correlative)==null?void 0:y.split("_")[2])||"Sección",e.jsxs("small",{className:"text-muted ms-2",children:["(",s.correlative,")"]})]})}),e.jsxs("div",{className:"card-body",children:[s.is_video==="1"||s.is_video===1?e.jsx("video",{src:`/api/landing_home/video/${s.video}`,className:"img-fluid mb-3",style:{maxHeight:"200px",width:"100%",objectFit:"cover"},onError:p=>p.target.src="/api/cover/thumbnail/null",controls:!0}):s.image?e.jsx("img",{src:`/api/landing_home/media/${s.image}`,className:"img-fluid mb-3",style:{maxHeight:"200px",width:"100%",objectFit:"cover"},onError:p=>p.target.src="/api/cover/thumbnail/null"}):e.jsx("div",{className:"bg-light mb-3",style:{height:"200px",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx("span",{className:"text-muted",children:"Sin imagen/video"})}),s.title&&e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"Título:"}),e.jsx(U,{data:s,field:"title",currentLangId:t,defaultLangId:o,onSave:(p,b)=>G(s.id,p,b)})]}),s.subtitle&&e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"Subtítulo:"}),e.jsx(U,{data:s,field:"subtitle",currentLangId:t,defaultLangId:o,onSave:(p,b)=>G(s.id,p,b)})]}),s.description&&e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"Descripción:"}),e.jsx(U,{data:s,field:"description",currentLangId:t,defaultLangId:o,onSave:(p,b)=>G(s.id,p,b)})]}),s.link&&e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"Enlace:"}),e.jsx(U,{data:s,field:"link",currentLangId:t,defaultLangId:o,onSave:(p,b)=>G(s.id,p,b)})]})]}),e.jsx("div",{className:"card-footer d-flex justify-content-end",children:e.jsxs("button",{className:"btn btn-sm btn-outline-primary me-2",onClick:()=>X(s),disabled:P,children:[e.jsx("i",{className:"fa fa-edit"})," ","Editar"]})})]})},s.id)})})]},r)})})]}),e.jsx(ie,{modalRef:a,title:V?"Editar sección":"Agregar sección",onSubmit:_,size:"lg",children:e.jsxs("div",{className:"row",id:"principal-container",children:[e.jsx("input",{ref:S,type:"hidden"}),e.jsxs("div",{className:"col-md-6",children:[e.jsx(K,{eRef:I,label:"Título",placeholder:"Título principal de la sección",required:!0}),e.jsx(K,{eRef:k,label:"Subtítulo",placeholder:"Subtítulo opcional"}),e.jsx(ae,{eRef:E,label:"Descripción",rows:3,placeholder:"Descripción detallada de la sección"}),e.jsx(K,{eRef:w,label:"Enlace",placeholder:"https://ejemplo.com"})]}),e.jsxs("div",{className:"col-md-6",children:[e.jsx(oe,{eRef:F,onChange:r=>j(r.target.checked),label:"Usar video en lugar de imagen",specification:"Solo se mostrará el video en la sección"}),R?e.jsx(ue,{eRef:C,label:"Video",col:"col-12",required:!V}):e.jsx(ce,{eRef:l,label:"Imagen",col:"col-12",aspect:16/9,fit:"contain",src:Z})]})]})})]})};ne((m,t)=>{se(m).render(e.jsx(te,{...t,title:"Landing Inicio",children:e.jsx(fe,{...t})}))});
