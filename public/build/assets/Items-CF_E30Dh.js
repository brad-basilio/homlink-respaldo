import{j as r}from"./RequirementCard-DEdD30eg.js";import{C as Z,e as ee,s as te,a8 as O,R as p,S as f,D as q,l as re,h as g,o as P,j as le,a3 as ie}from"./CreateReactScript-C-mUikVe.js";import{r as s}from"./index-RYns6xqu.js";import{c as se}from"./ReactAppend-vpV7VTGG.js";import{r as T}from"./DxBox-DZgBbgD6.js";import{S as ne}from"./sweetalert2.all-DJo0UVK6.js";import"./DataGrid-Cd7cnf9r.js";import"./Filter-BDLE8FWR.js";import"./axios-B4uVmeYG.js";import"./index-CXU7o9CY.js";import"./TippyButton-Duhaw_sS.js";import"./MenuItem-CBKDeUjr.js";import"./___vite-browser-external_commonjs-proxy-DbMF7jdq.js";import"./Results-CoLI09XT.js";import"./TinyMCEFormGroup-TcwoFScW.js";import"./index-DNUR7M9R.js";import"./Detail-BKcVR7Sx.js";import"./index-SDlHnhXR.js";import"./HomeSeccionBlog-CZ04iwe8.js";import"./CarruselBrands-Chpi1Apc.js";import"./Strengths-8rnVxSkq.js";import"./ModalAppointment-BjEduSb5.js";import"./CallToAction-3RvJBMpr.js";import"./WeCupSection-CkKcxXUy.js";import"./BlurText-Cr9yZ_QA.js";import"./Supplies-DJwkpyzw.js";import"./Banner-CXqQ-nCn.js";import"./HeroSecctionEmpresa-Bs7Po8J9.js";import"./WhatsAppModal-BCTi89gL.js";const h=new ie,ae=({categories:y,brands:R})=>{const[x,L]=s.useState([]),m=s.useRef(),w=s.useRef(),C=s.useRef(),D=s.useRef(),k=s.useRef(),N=s.useRef(),d=s.useRef(),o=s.useRef(),b=s.useRef(),F=s.useRef(),S=s.useRef(),I=s.useRef(),[U,E]=s.useState(!1),[ce,M]=s.useState(null),[oe,z]=s.useState(null),[v,c]=s.useState([]),G=s.useRef(),V=e=>{const l=Array.from(e.target.files).map(i=>({file:i,url:URL.createObjectURL(i)}));c(i=>[...i,...l])},J=e=>{e.preventDefault();const l=Array.from(e.dataTransfer.files).map(i=>({file:i,url:URL.createObjectURL(i)}));c(i=>[...i,...l])},H=e=>{e.preventDefault()},K=(e,t)=>{e.preventDefault(),v[t].id?c(i=>i.map((a,u)=>u===t?{...a,toDelete:!0}:a)):c(i=>i.filter((a,u)=>u!==t))};s.useEffect(()=>{if(x&&x.images){const e=x.images.map(t=>({id:t.id,url:`/api/items/media/${t.url}`}));c(e)}},[x]);const _=e=>{if(L(e||null),e!=null&&e.id?E(!0):E(!1),C.current.value=(e==null?void 0:e.id)||"",$(D.current).val((e==null?void 0:e.category_id)||null).trigger("change"),k.current.value=(e==null?void 0:e.name)||"",N.current.value=(e==null?void 0:e.summary)||"",d.current.value=(e==null?void 0:e.price)||0,o.current.value=(e==null?void 0:e.discount)||0,$(S.current).val((e==null?void 0:e.score)||null).trigger("change"),b.current.value=null,b.image.src=`/api/items/media/${(e==null?void 0:e.image)??"undefined"}`,F.current.value=(e==null?void 0:e.description)??"",e!=null&&e.images){const t=e.images.map(l=>({id:l.id,url:`/api/items/media/${l.url}`}));c(t)}else c([]);I.current.value=e==null?void 0:e.stock,$(w.current).modal("show")},Q=async e=>{e.preventDefault();let t=0,l=0;o.current.value&&o.current.value>0?(t=o.current.value,l=100-o.current.value*100/d.current.value):(t=d.current.value,l=0);const i={id:C.current.value||void 0,category_id:D.current.value,name:k.current.value,summary:N.current.value,price:d.current.value,discount:o.current.value,description:F.current.value,sotck:I.current.value,score:S.current.value,final_price:t,discount_percent:l},a=new FormData;for(const n in i)a.append(n,i[n]);const u=b.current.files[0];u&&a.append("image",u),v.forEach((n,B)=>{n.toDelete||(n.file?a.append(`gallery[${B}]`,n.file):a.append(`gallery_ids[${B}]`,n.id))});const A=v.filter(n=>n.toDelete).map(n=>parseInt(n.id,10));A.length>0&&a.append("deleted_images",JSON.stringify(A)),await h.save(a)&&($(m.current).dxDataGrid("instance").refresh(),$(w.current).modal("hide"),c([]))},W=async({id:e,value:t})=>{await h.boolean({id:e,field:"visible",value:t})&&$(m.current).dxDataGrid("instance").refresh()},j=async({id:e,field:t,value:l})=>{await h.boolean({id:e,field:t,value:l})&&$(m.current).dxDataGrid("instance").refresh()},X=async e=>{const{isConfirmed:t}=await ne.fire({title:"Eliminar Item",text:"¿Estás seguro de eliminar este item?",icon:"warning",showCancelButton:!0,confirmButtonText:"Sí, eliminar",cancelButtonText:"Cancelar"});!t||!await h.delete(e)||$(m.current).dxDataGrid("instance").refresh()},Y=[{value:1,label:"1"},{value:2,label:"2"},{value:3,label:"3"},{value:4,label:"4"},{value:5,label:"5"}];return r.jsxs(r.Fragment,{children:[r.jsx(te,{gridRef:m,title:"Items",rest:h,toolBar:e=>{e.unshift({widget:"dxButton",location:"after",options:{icon:"refresh",hint:"Refrescar tabla",onClick:()=>$(m.current).dxDataGrid("instance").refresh()}}),e.unshift({widget:"dxButton",location:"after",options:{icon:"plus",text:"Agregar",hint:"Agregar",onClick:()=>_()}})},exportable:!0,exportableName:"Items",columns:[{dataField:"id",caption:"ID",visible:!1},{dataField:"category.name",caption:"Categoría",width:"120px",cellTemplate:(e,{data:t})=>{var l,i;e.html(T(r.jsxs(r.Fragment,{children:[r.jsx("b",{className:"d-block",children:(l=t.category)==null?void 0:l.name}),r.jsx("small",{className:"text-muted",children:(i=t.subcategory)==null?void 0:i.name})]})))}},{dataField:"category.name",caption:"Categoria",visible:!1},{dataField:"name",caption:"Nombre",width:"300px",cellTemplate:(e,{data:t})=>{e.html(T(r.jsxs(r.Fragment,{children:[r.jsx("b",{children:t.name}),r.jsx("br",{}),r.jsx("span",{className:"truncate",children:t.summary})]})))}},{dataField:"final_price",caption:"Precio",dataType:"number",width:"75px",cellTemplate:(e,{data:t})=>{e.html(T(r.jsxs(r.Fragment,{children:[t.discount>0&&r.jsxs("small",{className:"d-block text-muted",style:{textDecoration:"line-through"},children:["S/.",O(t.price)]}),r.jsxs("span",{children:["S/.",O(t.discount>0?t.discount:t.price)]})]})))}},{dataField:"image",caption:"Imagen",width:"90px",allowFiltering:!1,cellTemplate:(e,{data:t})=>{p(e,r.jsx("img",{src:`/api/items/media/${t.image}`,style:{width:"80px",height:"48px",objectFit:"cover",objectPosition:"center",borderRadius:"4px"},onError:l=>l.target.src="/api/cover/thumbnail/null"}))}},{dataField:"is_new",caption:"Nuevo",dataType:"boolean",width:"80px",cellTemplate:(e,{data:t})=>{p(e,r.jsx(f,{checked:t.is_new,onChange:l=>j({id:t.id,field:"is_new",value:l.target.checked})}))}},{dataField:"offering",caption:"En oferta",dataType:"boolean",width:"80px",cellTemplate:(e,{data:t})=>{p(e,r.jsx(f,{checked:t.offering,onChange:l=>j({id:t.id,field:"offering",value:l.target.checked})}))}},{dataField:"recommended",caption:"Recomendado",dataType:"boolean",width:"80px",cellTemplate:(e,{data:t})=>{p(e,r.jsx(f,{checked:t.recommended,onChange:l=>j({id:t.id,field:"recommended",value:l.target.checked})}))}},{dataField:"featured",caption:"Destacado",dataType:"boolean",width:"80px",cellTemplate:(e,{data:t})=>{p(e,r.jsx(f,{checked:t.featured,onChange:l=>j({id:t.id,field:"featured",value:l.target.checked})}))}},{dataField:"visible",caption:"Visible",dataType:"boolean",width:"80px",cellTemplate:(e,{data:t})=>{p(e,r.jsx(f,{checked:t.visible,onChange:l=>W({id:t.id,value:l.target.checked})}))}},{caption:"Acciones",width:"100px",cellTemplate:(e,{data:t})=>{e.css("text-overflow","unset"),e.append(q({className:"btn btn-xs btn-soft-primary",title:"Editar",icon:"fa fa-pen",onClick:()=>_(t)})),e.append(q({className:"btn btn-xs btn-soft-danger",title:"Eliminar",icon:"fa fa-trash",onClick:()=>X(t.id)}))},allowFiltering:!1,allowExporting:!1}]}),r.jsxs(re,{modalRef:w,title:U?"Editar Item":"Agregar Item",onSubmit:Q,size:"xl",children:[r.jsxs("div",{className:"row",id:"principal-container",children:[r.jsx("input",{ref:C,type:"hidden"}),r.jsxs("div",{className:"col-md-6",children:[r.jsx(g,{eRef:k,label:"Nombre",required:!0}),r.jsx(g,{eRef:N,label:"Resumen"}),r.jsx(P,{eRef:D,label:"Categoría",required:!0,dropdownParent:"#principal-container",onChange:e=>M(e.target.value),children:y.map((e,t)=>r.jsx("option",{value:e.id,children:e.name},t))}),r.jsx(g,{label:"Stock",eRef:I,type:"number"}),r.jsx(g,{eRef:d,label:"Precio",type:"number",step:"0.01",required:!0}),r.jsx(g,{eRef:o,label:"Descuento",type:"number",step:"0.01"}),r.jsx(P,{eRef:S,label:"Calificación",required:!0,dropdownParent:"#principal-container",onChange:e=>z(e.target.value),children:Y.map((e,t)=>r.jsx("option",{value:e.value,children:e.label},t))})]}),r.jsx("div",{className:"col-md-6",children:r.jsxs("div",{className:"row",children:[r.jsx(le,{eRef:b,label:"Imagen",aspect:1,col:"col-lg-6 col-md-12 col-sm-6"}),r.jsxs("div",{className:"col-lg-6 col-md-12 col-sm-6",children:[r.jsx("label",{className:"form-label",children:"Galeria"}),r.jsx("input",{id:"input-item-gallery",ref:G,type:"file",multiple:!0,accept:"image/*",hidden:!0,onChange:V}),r.jsx("div",{style:{border:"2px dashed #ccc",padding:"20px",textAlign:"center",cursor:"pointer",borderRadius:"4px",boxShadow:"2.5px 2.5px 5px rgba(0,0,0,.125)",aspectRatio:"21/9",height:"254px",width:"100%",display:"flex",alignItems:"center",justifyContent:"center"},onClick:()=>G.current.click(),onDrop:J,onDragOver:H,children:r.jsx("span",{className:"form-label d-block mb-1",children:"Arrastra y suelta imágenes aquí o haz clic para agregar"})})]}),r.jsx("div",{className:"col-md-12 col-sm-12",children:r.jsx("div",{className:"d-flex flex-wrap gap-1  mt-2",children:v.map((e,t)=>r.jsxs("div",{className:"position-relative",style:{width:"80px",height:"80px"},children:[r.jsx("img",{src:`${e.url}`,alt:"preview",style:{width:"100%",height:"100%",objectFit:"cover",borderRadius:"4px"}}),r.jsx("button",{className:"btn btn-xs btn-danger position-absolute",style:{top:0,right:0},onClick:l=>K(l,t),children:"×"})]},t))})})]})})]}),r.jsx("hr",{className:"my-1"}),r.jsx("label",{className:"form-label",children:"Descripción"}),r.jsx("textarea",{ref:F,className:"form-control",placeholder:"Descripción"})]})]})};Z((y,R)=>{se(y).render(r.jsx(ee,{...R,title:"Items",children:r.jsx(ae,{...R})}))});
