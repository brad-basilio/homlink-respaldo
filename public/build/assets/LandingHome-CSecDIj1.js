import{j as e}from"./RequirementCard-DEdD30eg.js";import{r as o}from"./index-RYns6xqu.js";import{c as _}from"./ReactAppend-vpV7VTGG.js";import{C as ee,e as re,M as se,h as J,f as te,S as ne,j as ie,a9 as oe,aa as ce}from"./CreateReactScript-C-mUikVe.js";import"./sweetalert2.all-DJo0UVK6.js";import{m as L}from"./DataGrid-Cd7cnf9r.js";import"./index-CXU7o9CY.js";import"./Filter-BDLE8FWR.js";import"./axios-B4uVmeYG.js";import"./TippyButton-Duhaw_sS.js";import"./MenuItem-CBKDeUjr.js";import"./___vite-browser-external_commonjs-proxy-DbMF7jdq.js";import"./Results-CoLI09XT.js";import"./DxBox-DZgBbgD6.js";import"./TinyMCEFormGroup-TcwoFScW.js";import"./index-DNUR7M9R.js";import"./Detail-BKcVR7Sx.js";import"./index-SDlHnhXR.js";import"./HomeSeccionBlog-CZ04iwe8.js";import"./CarruselBrands-Chpi1Apc.js";import"./Strengths-8rnVxSkq.js";import"./ModalAppointment-BjEduSb5.js";import"./CallToAction-3RvJBMpr.js";import"./WeCupSection-CkKcxXUy.js";import"./BlurText-Cr9yZ_QA.js";import"./Supplies-DJwkpyzw.js";import"./Banner-CXqQ-nCn.js";import"./HeroSecctionEmpresa-Bs7Po8J9.js";import"./WhatsAppModal-BCTi89gL.js";const q=new ce,le=v=>{if(!v)return"home";const i=v.split("_");return i.length<2?"home":i[1]},z=({data:v,field:i,currentLangId:d,defaultLangId:x,onSave:F})=>{const[B,M]=o.useState(v[i]||""),[V,w]=o.useState(!1),E=d===x,g=!E,A=()=>{F(i,B),w(!1)};return e.jsx("div",{className:`d-flex gap-2 align-items-center ${g?"translation-field":""}`,children:E?e.jsx("span",{children:v[i]}):e.jsxs(e.Fragment,{children:[e.jsx("input",{className:"form-control flex-grow-1",value:B,onChange:T=>{M(T.target.value),w(!0)},disabled:!g}),V&&g&&e.jsx("button",{className:"btn btn-xs btn-soft-primary",onClick:A,children:e.jsx("i",{className:"fa fa-save"})})]})})},ae=({items:v,current_lang_id:i,default_lang_id:d})=>{const x=o.useRef(),[F,B]=o.useState("home"),[M,V]=o.useState(!1),[w,E]=o.useState(!1);o.useState("");const[g,A]=o.useState(v),[T,O]=o.useState({}),[X,K]=o.useState(!1),b=o.useRef(null),j=o.useRef(null),N=o.useRef(null),y=o.useRef(null),c=o.useRef(null),S=o.useRef(null),I=o.useRef(null),k=o.useRef(null),[Y,P]=o.useState(null),D={home:"Inicio",catalogo:"Catálogo",aboutus:"Nosotros",contact:"Contacto",blog:"Blog"};o.useEffect(()=>{(async()=>{if(i!==d){K(!0);try{const t=await q.getByLang(i),a={};t.forEach(s=>{s.original_id&&(a[s.original_id]=s)}),O(a)}catch(t){L.Notify.error("Error al cargar traducciones"),console.error("Error loading translations:",t)}finally{K(!1)}}else O({})})()},[i,d]);const C=g.reduce((r,t)=>{const a=le(t.correlative);r[a]||(r[a]=[]);const s=T[t.original_id||t.id]||{},h={...t,title:i!==d&&s.title||t.title,subtitle:i!==d&&s.subtitle||t.subtitle,description:i!==d&&s.description||t.description,link:i!==d&&s.link||t.link,is_translated:!!s.id};return r[a].push(h),r},{});o.useEffect(()=>{var r;console.log("Items agrupados:",C),console.log("Items en home:",(r=C.home)==null?void 0:r.length),console.log("Total items:",g.length)},[C,g]),o.useEffect(()=>{console.log("Items cambiaron, total:",g.length)},[g]);const Q=r=>{r!=null&&r.id?V(!0):(V(!1),setTimeout(()=>{b.current&&(b.current.value=""),j.current&&(j.current.value=""),N.current&&(N.current.value=""),y.current&&(y.current.value=""),I.current&&(I.current.value=""),k.current&&(k.current.checked=!1),c.current&&(c.current.value="",setTimeout(()=>{c.current&&c.current.image&&(c.current.image.src="")},50)),E(!1)},50));const t=(r==null?void 0:r.is_video)==="1"||(r==null?void 0:r.is_video)===1;E(t),setTimeout(()=>{r!=null&&r.id&&(b.current&&(b.current.value=(r==null?void 0:r.id)??""),j.current&&(j.current.value=(r==null?void 0:r.title)??""),N.current&&(N.current.value=(r==null?void 0:r.subtitle)??""),y.current&&(y.current.value=(r==null?void 0:r.description)??""),I.current&&(I.current.value=(r==null?void 0:r.link)??""),k.current&&(k.current.checked=t),t&&S.current&&(r!=null&&r.video)?S.current.setVideoSrc(`/api/landing_home/video/${r.video}`):!t&&c.current&&(r!=null&&r.image)&&setTimeout(()=>{if(c.current){const s=`/api/landing_home/media/${r.image}`;console.log("Cargando imagen en modal:",s),console.log("ImageRef.current:",c.current),console.log("ImageRef.current.image:",c.current.image),c.current.src=s,P(s)}else console.log("ImageRef o image no disponible:",{imageRef:!!c.current,image:!!(c.current&&c.current.image)})},100))},300),new bootstrap.Modal(x.current).show()},Z=async r=>{var t,a,s,h,u,p,l,G;r.preventDefault();try{const m=new FormData;if((t=b.current)!=null&&t.value&&m.append("id",b.current.value),(a=j.current)!=null&&a.value&&m.append("title",j.current.value),(s=N.current)!=null&&s.value&&m.append("subtitle",N.current.value),(h=y.current)!=null&&h.value&&m.append("description",y.current.value),(u=I.current)!=null&&u.value&&m.append("link",I.current.value),m.append("is_video",(p=k.current)!=null&&p.checked?"1":"0"),m.append("lang_id",d),w&&S.current){const n=S.current.getFile();n&&m.append("video",n)}else!w&&((G=(l=c.current)==null?void 0:l.files)!=null&&G[0])&&m.append("image",c.current.files[0]);const R=await q.save(m);if(!R){L.Notify.error("Error al guardar la sección");return}console.log("Resultado del save:",R),A(M?n=>n.map(f=>f.id===R.data.id?R.data:f):n=>[R.data,...n]);try{const n=await q.paginate({page:1,per_page:1e3,search:"",orderBy:"created_at",order:"desc"});if(console.log("Respuesta completa de paginate:",n),n){let f=null;n.data&&Array.isArray(n.data)?f=n.data:n.result&&n.result.data&&Array.isArray(n.result.data)?f=n.result.data:Array.isArray(n)&&(f=n),console.log("Items extraídos:",f),f&&f.length>=0&&(A(f),console.log("Items actualizados desde servidor:",f.length))}}catch(n){console.warn("Error al recargar desde servidor, usando actualización local",n)}try{const n=x.current.querySelector(".btn-close");if(n)n.click();else{const f=x.current.querySelector('[data-bs-dismiss="modal"]');if(f)f.click();else{const W=bootstrap.Modal.getInstance(x.current);W?W.hide():new bootstrap.Modal(x.current).hide()}}}catch(n){console.error("Error al cerrar modal:",n),$(x.current).modal("hide")}setTimeout(()=>{b.current&&(b.current.value=""),j.current&&(j.current.value=""),N.current&&(N.current.value=""),y.current&&(y.current.value=""),I.current&&(I.current.value=""),k.current&&(k.current.checked=!1),c.current&&(c.current.value="",setTimeout(()=>{c.current&&c.current.image&&(c.current.image.src="")},50)),S.current&&typeof S.current.clearVideo=="function"&&S.current.clearVideo(),E(!1),V(!1),P(null)},200),L.Notify.success("Sección guardada correctamente")}catch(m){console.error("Error al enviar el formulario:",m),L.Notify.error("Hubo un error al enviar el formulario")}},H=async(r,t,a)=>{var s,h,u,p;try{const l=g.find(R=>R.id===r);if(!l)return;const G={original_id:l.original_id||l.id,[t]:a,lang_id:i,title:t==="title"?a:((s=T[l.id])==null?void 0:s.title)||l.title,subtitle:t==="subtitle"?a:((h=T[l.id])==null?void 0:h.subtitle)||l.subtitle,description:t==="description"?a:((u=T[l.id])==null?void 0:u.description)||l.description,link:t==="link"?a:((p=T[l.id])==null?void 0:p.link)||l.link},m=await q.translate(G);if(!m)return;O(R=>{const n={...R};return n[l.id]||(n[l.id]={...l,id:m.id,original_id:l.id,lang_id:i}),n[l.id][t]=a,n}),L.Notify.success("Traducción guardada correctamente")}catch(l){L.Notify.error("Error al guardar traducción"),console.error(l)}},U=i!==d;return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:`card ${U?"translation-mode":""}`,children:[e.jsxs("div",{className:"card-header d-flex justify-content-between align-items-center",children:[e.jsx("ul",{className:"nav nav-tabs card-header-tabs",children:Object.keys(D).map(r=>e.jsx("li",{className:"nav-item",children:e.jsx("button",{className:`nav-link ${F===r?"active":""}`,onClick:()=>B(r),children:D[r]})},r))}),e.jsxs("div",{className:"d-flex align-items-center gap-2",children:[U&&e.jsxs("span",{className:"badge bg-success me-2",style:{padding:"6px"},children:[e.jsx("i",{className:"fa fa-language me-1"})," Modo Traducción"]}),e.jsxs("button",{className:"btn btn-primary btn-sm",onClick:()=>Q({correlative:`page_${F}_new`,lang_id:d}),children:[e.jsx("i",{className:"fa fa-plus me-1"})," Nueva Sección"]})]})]}),e.jsx("div",{className:"card-body",children:X?e.jsxs("div",{className:"text-center py-5",children:[e.jsx("div",{className:"spinner-border text-primary",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Cargando..."})}),e.jsx("p",{className:"mt-2",children:"Cargando traducciones..."})]}):Object.keys(D).map(r=>{var t,a;return e.jsxs("div",{style:{display:F===r?"block":"none"},children:[e.jsxs("h4",{className:"mb-4",children:["Secciones de ",D[r]]}),e.jsxs("p",{className:"text-muted mb-3",children:["Mostrando ",((t=C[r])==null?void 0:t.length)||0," ","secciones"]}),((a=C[r])==null?void 0:a.length)===0?e.jsx("div",{className:"alert alert-info",children:"No hay secciones configuradas para esta página"}):e.jsx("div",{className:"row",children:(C[r]||[]).map(s=>{var h;return e.jsx("div",{className:"col-md-6 mb-4",children:e.jsxs("div",{className:"card h-100",children:[e.jsx("div",{className:"card-header d-flex justify-content-between align-items-center",children:e.jsxs("h5",{className:"mb-0",children:[((h=s.correlative)==null?void 0:h.split("_")[2])||"Sección",e.jsxs("small",{className:"text-muted ms-2",children:["(",s.correlative,")"]})]})}),e.jsxs("div",{className:"card-body",children:[s.is_video==="1"||s.is_video===1?e.jsx("video",{src:`/api/landing_home/video/${s.video}`,className:"img-fluid mb-3",style:{maxHeight:"200px",width:"100%",objectFit:"cover"},onError:u=>u.target.src="/api/cover/thumbnail/null",controls:!0}):s.image?e.jsx("img",{src:`/api/landing_home/media/${s.image}`,className:"img-fluid mb-3",style:{maxHeight:"200px",width:"100%",objectFit:"cover"},onError:u=>u.target.src="/api/cover/thumbnail/null"}):e.jsx("div",{className:"bg-light mb-3",style:{height:"200px",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx("span",{className:"text-muted",children:"Sin imagen/video"})}),s.title&&e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"Título:"}),e.jsx(z,{data:s,field:"title",currentLangId:i,defaultLangId:d,onSave:(u,p)=>H(s.id,u,p)})]}),s.subtitle&&e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"Subtítulo:"}),e.jsx(z,{data:s,field:"subtitle",currentLangId:i,defaultLangId:d,onSave:(u,p)=>H(s.id,u,p)})]}),s.description&&e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"Descripción:"}),e.jsx(z,{data:s,field:"description",currentLangId:i,defaultLangId:d,onSave:(u,p)=>H(s.id,u,p)})]}),s.link&&e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"Enlace:"}),e.jsx(z,{data:s,field:"link",currentLangId:i,defaultLangId:d,onSave:(u,p)=>H(s.id,u,p)})]})]}),e.jsx("div",{className:"card-footer d-flex justify-content-end",children:e.jsxs("button",{className:"btn btn-sm btn-outline-primary me-2",onClick:()=>Q(s),disabled:U,children:[e.jsx("i",{className:"fa fa-edit"})," ","Editar"]})})]})},s.id)})})]},r)})})]}),e.jsx(se,{modalRef:x,title:M?"Editar sección":"Agregar sección",onSubmit:Z,size:"lg",children:e.jsxs("div",{className:"row",id:"principal-container",children:[e.jsx("input",{ref:b,type:"hidden"}),e.jsxs("div",{className:"col-md-6",children:[e.jsx(J,{eRef:j,label:"Título",placeholder:"Título principal de la sección",required:!0}),e.jsx(J,{eRef:N,label:"Subtítulo",placeholder:"Subtítulo opcional"}),e.jsx(te,{eRef:y,label:"Descripción",rows:3,placeholder:"Descripción detallada de la sección"}),e.jsx(J,{eRef:I,label:"Enlace",placeholder:"https://ejemplo.com"})]}),e.jsxs("div",{className:"col-md-6",children:[e.jsx(ne,{eRef:k,onChange:r=>E(r.target.checked),label:"Usar video en lugar de imagen",specification:"Solo se mostrará el video en la sección"}),w?e.jsx(oe,{eRef:S,label:"Video",col:"col-12",required:!M}):e.jsx(ie,{eRef:c,label:"Imagen",col:"col-12",aspect:16/9,fit:"contain",src:Y})]})]})})]})};ee((v,i)=>{_(v).render(e.jsx(re,{...i,title:"Landing Inicio",children:e.jsx(ae,{...i})}))});
