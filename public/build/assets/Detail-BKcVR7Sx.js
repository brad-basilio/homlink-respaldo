var E=Object.defineProperty;var O=(f,s,i)=>s in f?E(f,s,{enumerable:!0,configurable:!0,writable:!0,value:i}):f[s]=i;var h=(f,s,i)=>(O(f,typeof s!="symbol"?s+"":s,i),i);import{j as v}from"./RequirementCard-DEdD30eg.js";import{r as q}from"./index-RYns6xqu.js";import{m as x}from"./DataGrid-Cd7cnf9r.js";import{B as I}from"./Results-CoLI09XT.js";import"./___vite-browser-external_commonjs-proxy-DbMF7jdq.js";class P extends I{constructor(){super(...arguments);h(this,"path","items");h(this,"verifyStock",async i=>{try{const{status:l,result:y}=await x.Fetch(`/api/${this.path}/verify-stock`,{method:"POST",body:JSON.stringify(i)});if(!l)throw new Error((y==null?void 0:y.message)??"Ocurrió un error al consultar el stock de los productos");return y.data??[]}catch{return[]}});h(this,"getDestacados",async()=>{try{const{status:i,result:l}=await x.Fetch(`/api/${this.path}/get-destacados`,{method:"GET"});if(!i)throw new Error((l==null?void 0:l.message)??"Ocurrió un error al consultar el stock de los productos");return l.data??[]}catch{return[]}})}}const z=q.createContext(),V=new P,b=({children:f})=>{const[s,i]=q.useState(()=>{const r=localStorage.getItem("carrito");return r?JSON.parse(r):[]}),l=async()=>{try{if(s.length===0)return;V.verifyStock(s.map(r=>r.id)).then(r=>{const a=s.map(c=>{const t=r.find(n=>n.id===c.id);return t?{...c,price:t.price,final_price:t.final_price,discount:t.discount,name:t.name}:c});i(a)})}catch(r){console.error("Error al actualizar precios:",r)}};q.useEffect(()=>{l()},[]),q.useEffect(()=>{localStorage.setItem("carrito",JSON.stringify(s))},[s]);const y=r=>{i(a=>{var e;if(!(r.sizes&&r.sizes.length>0||r.colors&&r.colors.length>0))return a.find(o=>o.id===r.id)?a.map(o=>o.id===r.id?{...o,quantity:o.quantity+r.quantity}:o):[...a,{...r,variations:[],quantity:r.quantity}];const t={color:r.selectedColor||null,size:r.selectedSize||null,quantity:r.quantity},n=a.findIndex(u=>u.id===r.id);if(n>=0){const u=[...a],o=u[n],g=((e=o.variations)==null?void 0:e.findIndex(d=>d.color===t.color&&d.size===t.size))??-1;return g>=0?u[n]={...o,variations:o.variations.map((d,_)=>_===g?{...d,quantity:d.quantity+t.quantity}:d)}:u[n]={...o,variations:[...o.variations,t]},u}else return[...a,{...r,variations:[t],quantity:r.quantity}]})},C=r=>{i(a=>a.filter(c=>c.id!==r))},m=()=>{i([])},p=(r,a=null)=>{i(c=>c.map(t=>t.id===r&&(!t.variations||t.variations.length===0)?{...t,quantity:t.quantity+1}:t.id===r&&t.variations&&t.variations.length>0?a?{...t,variations:t.variations.map(n=>n.color===a.color&&n.size===a.size?{...n,quantity:n.quantity+1}:n)}:{...t,variations:t.variations.map((n,e)=>e===0?{...n,quantity:n.quantity+1}:n)}:t))},w=(r,a=null)=>{i(c=>c.map(t=>{if(t.id===r&&(!t.variations||t.variations.length===0))return{...t,quantity:Math.max(1,t.quantity-1)};if(t.id===r&&t.variations&&t.variations.length>0){if(!a){const e=t.variations.map((u,o)=>o===0?{...u,quantity:Math.max(1,u.quantity-1)}:u);return{...t,variations:e}}const n=t.variations.map(e=>e.color===a.color&&e.size===a.size?{...e,quantity:Math.max(1,e.quantity-1)}:e);return{...t,variations:n}}return t}))},S=(r,a=null)=>{i(c=>a?c.map(t=>{if(t.id===r&&t.variations){const n=t.variations.filter(e=>!(e.color===a.color&&e.size===a.size&&e.quantity===0));return n.length===0?null:{...t,variations:n}}return t}).filter(Boolean):c.filter(t=>!(t.id===r&&t.quantity===0)))};return v.jsx(z.Provider,{value:{carrito:s,agregarAlCarrito:y,eliminarProducto:C,vaciarCarrito:m,actualizarPrecios:l,decrementarCantidad:w,incrementarCantidad:p,eliminarSiCero:S},children:f})},N=Object.freeze(Object.defineProperty({__proto__:null,CarritoContext:z,CarritoProvider:b},Symbol.toStringTag,{value:"Module"}));export{b as C,N as _,z as a};
